2025-08-05 14:15:38,409 - [__main__] Rank 1 - INFO - Initializing server on rank 1
2025-08-05 14:15:38,409 - [__main__] Rank 1 - INFO - Initialized WorkerServicer for rank 1
2025-08-05 14:15:38,410 - [__main__] Rank 1 - INFO - Worker 1 loading model mlx-community/Qwen3-1.7B-8bit
2025-08-05 14:15:39,251 - [__main__] Rank 1 - INFO - Worker 1 initialized persistent KV cache with 28 objects
2025-08-05 14:15:39,252 - [__main__] Rank 1 - INFO - Worker 1 loaded successfully, handling layers: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:39,252 - [__main__] Rank 1 - INFO - Worker 1 gRPC server started on port 50052
2025-08-05 14:15:39,252 - [__main__] Rank 1 - INFO - Server initialized successfully on rank 1
2025-08-05 14:15:39,252 - [__main__] Rank 1 - INFO - Worker 1 ready and serving
2025-08-05 14:15:57,629 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:57,630 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 26352 bytes
2025-08-05 14:15:57,630 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 8, 2048], data_size=26352
2025-08-05 14:15:57,630 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 0f5e537d662cb0d8, size=26352
2025-08-05 14:15:57,630 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=0f5e537d662cb0d8, metadata checksum=NO_CHECKSUM
2025-08-05 14:15:57,647 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 14.000000, shape=(1, 8, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 14.000000, shape=(1, 8, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,659 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 14.000000, values=[1.8125, 14.0, -5.40625, 1.4453125]...
2025-08-05 14:15:57,662 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=0f5e537d662cb0d8, norm=508.000, first_4=[1.8125, 14.0, -5.40625, 1.4453125], checksum=1176.000000, shape=(1, 8, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:15:57,671 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,674 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,679 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,683 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,687 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,691 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,697 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,702 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,707 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,710 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,715 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,718 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,722 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,726 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,730 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,733 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,738 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,741 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,746 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,750 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,754 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,757 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,761 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,765 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,769 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,774 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,779 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,782 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,0) (15,0) (16,0) (17,0) (18,0) (19,0)
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,0) (21,0) (22,0) (23,0) (24,0) (25,0) (26,0) (27,0)
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=0 L15:off=0 L16:off=0 L17:off=0 L18:off=0 L19:off=0 L20:off=0 L21:off=0 L22:off=0 L23:off=0 L24:off=0 L25:off=0 L26:off=0 L27:off=0
2025-08-05 14:15:57,784 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:15:57,786 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.071777, var=15.750000, max_abs=56.500000 [CRITICAL][0m
2025-08-05 14:15:57,786 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=56.500000[0m
2025-08-05 14:15:57,786 - [__main__] Rank 1 - ERROR - First 10 values: [1.8125, 14.0, -5.40625, 1.4453125, -2.734375, 3.5625, -4.0, -3.109375, 0.71875, 2.390625]
2025-08-05 14:15:57,788 - [__main__] Rank 1 - ERROR -   Index 6095: value=56.500000
2025-08-05 14:15:57,788 - [__main__] Rank 1 - ERROR -   Index 1371: value=-52.500000
2025-08-05 14:15:57,788 - [__main__] Rank 1 - ERROR -   Index 3419: value=-51.500000
2025-08-05 14:15:57,788 - [__main__] Rank 1 - ERROR -   Index 5467: value=-49.250000
2025-08-05 14:15:57,789 - [__main__] Rank 1 - ERROR -   Index 10191: value=46.750000
2025-08-05 14:15:57,804 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.104004, var=20.250000, max_abs=65.500000 [CRITICAL][0m
2025-08-05 14:15:57,804 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=65.500000[0m
2025-08-05 14:15:57,804 - [__main__] Rank 1 - ERROR - First 10 values: [0.8984375, 21.625, -9.4375, 2.546875, -4.0, 4.0, -5.6875, -2.34375, 1.140625, 4.09375]
2025-08-05 14:15:57,805 - [__main__] Rank 1 - ERROR -   Index 3419: value=-65.500000
2025-08-05 14:15:57,805 - [__main__] Rank 1 - ERROR -   Index 1371: value=-65.000000
2025-08-05 14:15:57,805 - [__main__] Rank 1 - ERROR -   Index 5467: value=-62.500000
2025-08-05 14:15:57,805 - [__main__] Rank 1 - ERROR -   Index 7515: value=-57.500000
2025-08-05 14:15:57,806 - [__main__] Rank 1 - ERROR -   Index 11611: value=-57.000000
2025-08-05 14:15:57,806 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=584.000, offset=8, step=256
2025-08-05 14:15:57,807 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=121.000, offset=8, step=256
2025-08-05 14:15:57,818 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=370.000, offset=8, step=256
2025-08-05 14:15:57,829 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1304.000, offset=8, step=256
2025-08-05 14:15:57,839 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=211.000, offset=8, step=256
2025-08-05 14:15:57,849 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1012.000, offset=8, step=256
2025-08-05 14:15:57,859 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=748.000, offset=8, step=256
2025-08-05 14:15:57,869 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-86.500, offset=8, step=256
2025-08-05 14:15:57,878 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-302.000, offset=8, step=256
2025-08-05 14:15:57,888 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=176.000, offset=8, step=256
2025-08-05 14:15:57,899 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1056.000, offset=8, step=256
2025-08-05 14:15:57,908 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-540.000, offset=8, step=256
2025-08-05 14:15:57,917 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1040.000, offset=8, step=256
2025-08-05 14:15:57,926 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.785156, var=6400.000000, max_abs=2008.000000 [CRITICAL][0m
2025-08-05 14:15:57,926 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2008.000000[0m
2025-08-05 14:15:57,926 - [__main__] Rank 1 - ERROR - First 10 values: [40.0, 85.0, -3.21875, 9.5625, -57.75, -45.25, -3.71875, 28.375, 21.0, 42.0]
2025-08-05 14:15:57,927 - [__main__] Rank 1 - ERROR -   Index 16129: value=2008.000000
2025-08-05 14:15:57,928 - [__main__] Rank 1 - ERROR -   Index 14081: value=1968.000000
2025-08-05 14:15:57,928 - [__main__] Rank 1 - ERROR -   Index 9985: value=1960.000000
2025-08-05 14:15:57,928 - [__main__] Rank 1 - ERROR -   Index 12033: value=1888.000000
2025-08-05 14:15:57,929 - [__main__] Rank 1 - ERROR -   Index 7937: value=1744.000000
2025-08-05 14:15:57,940 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-1.375000, var=3488.000000, max_abs=664.000000 [CRITICAL][0m
2025-08-05 14:15:57,940 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=664.000000[0m
2025-08-05 14:15:57,940 - [__main__] Rank 1 - ERROR - First 10 values: [25.75, 36.25, 30.125, 55.0, -103.5, -45.25, -12.875, 37.25, 25.0, 47.25]
2025-08-05 14:15:57,941 - [__main__] Rank 1 - ERROR -   Index 16129: value=664.000000
2025-08-05 14:15:57,941 - [__main__] Rank 1 - ERROR -   Index 1793: value=664.000000
2025-08-05 14:15:57,941 - [__main__] Rank 1 - ERROR -   Index 14081: value=624.000000
2025-08-05 14:15:57,941 - [__main__] Rank 1 - ERROR -   Index 7937: value=552.000000
2025-08-05 14:15:57,942 - [__main__] Rank 1 - ERROR -   Index 9985: value=544.000000
2025-08-05 14:15:57,942 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=348.000, offset=8, step=256
2025-08-05 14:15:57,942 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=8 L15:off=8 L16:off=8 L17:off=8 L18:off=8 L19:off=8 L20:off=8 L21:off=8 L22:off=8 L23:off=8 L24:off=8 L25:off=8 L26:off=8 L27:off=8
2025-08-05 14:15:57,944 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=5d9ad5d415ce417a, norm=7552.000, first_4=[25.75, 36.25, 30.125, 55.0], checksum=-22528.000000, shape=(1, 8, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:15:57,948 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 103.500000, values=[25.75, 36.25, 30.125, 55.0]...
2025-08-05 14:15:57,948 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=3511c37e8b5eff48, data size=26125 bytes
2025-08-05 14:15:57,948 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:15:57,961 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:15:57,962 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.03MB (tensor: 0.02MB, cache: 14.00MB)
2025-08-05 14:15:57,964 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 5d9ad5d415ce417a, size=26125
2025-08-05 14:15:58,317 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:58,317 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3340 bytes
2025-08-05 14:15:58,317 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3340
2025-08-05 14:15:58,317 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 60f579cb3b386e96, size=3340
2025-08-05 14:15:58,317 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=60f579cb3b386e96, metadata checksum=NO_CHECKSUM
2025-08-05 14:15:58,321 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 16.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 16.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,324 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 16.000000, values=[3.859375, 16.0, -3.28125, 0.2265625]...
2025-08-05 14:15:58,325 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=60f579cb3b386e96, norm=177.000, first_4=[3.859375, 16.0, -3.28125, 0.2265625], checksum=115.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:15:58,333 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,338 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,343 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,348 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,352 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,357 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,364 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,367 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,372 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,376 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,381 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,384 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,389 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,393 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,398 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,402 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,405 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,409 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,414 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,417 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,420 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,423 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,426 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,430 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,436 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,439 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,442 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,446 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,447 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:58,448 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:15:58,448 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:15:58,448 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:15:58,448 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=8 L15:off=8 L16:off=8 L17:off=8 L18:off=8 L19:off=8 L20:off=8 L21:off=8 L22:off=8 L23:off=8 L24:off=8 L25:off=8 L26:off=8 L27:off=8
2025-08-05 14:15:58,448 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:15:58,449 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.056396, var=15.250000, max_abs=44.000000 [CRITICAL][0m
2025-08-05 14:15:58,449 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=44.000000[0m
2025-08-05 14:15:58,449 - [__main__] Rank 1 - ERROR - First 10 values: [3.859375, 16.0, -3.28125, 0.2265625, 0.42578125, 1.6875, -1.0859375, -3.421875, 5.875, 1.265625]
2025-08-05 14:15:58,450 - [__main__] Rank 1 - ERROR -   Index 1371: value=-44.000000
2025-08-05 14:15:58,450 - [__main__] Rank 1 - ERROR -   Index 1793: value=-33.500000
2025-08-05 14:15:58,450 - [__main__] Rank 1 - ERROR -   Index 1999: value=33.000000
2025-08-05 14:15:58,450 - [__main__] Rank 1 - ERROR -   Index 940: value=31.125000
2025-08-05 14:15:58,451 - [__main__] Rank 1 - ERROR -   Index 331: value=23.500000
2025-08-05 14:15:58,452 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.120605, var=19.625000, max_abs=55.250000 [CRITICAL][0m
2025-08-05 14:15:58,452 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=55.250000[0m
2025-08-05 14:15:58,452 - [__main__] Rank 1 - ERROR - First 10 values: [2.25, 22.0, -4.65625, 2.90625, -2.265625, 1.140625, -0.34765625, -3.53125, 6.125, 1.984375]
2025-08-05 14:15:58,453 - [__main__] Rank 1 - ERROR -   Index 1371: value=-55.250000
2025-08-05 14:15:58,453 - [__main__] Rank 1 - ERROR -   Index 1999: value=43.500000
2025-08-05 14:15:58,453 - [__main__] Rank 1 - ERROR -   Index 940: value=39.500000
2025-08-05 14:15:58,453 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.000000
2025-08-05 14:15:58,454 - [__main__] Rank 1 - ERROR -   Index 331: value=32.250000
2025-08-05 14:15:58,454 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=728.000, offset=9, step=256
2025-08-05 14:15:58,454 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=97.000, offset=9, step=256
2025-08-05 14:15:58,455 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=382.000, offset=9, step=256
2025-08-05 14:15:58,456 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1488.000, offset=9, step=256
2025-08-05 14:15:58,457 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=238.000, offset=9, step=256
2025-08-05 14:15:58,458 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1112.000, offset=9, step=256
2025-08-05 14:15:58,459 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=816.000, offset=9, step=256
2025-08-05 14:15:58,460 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-81.000, offset=9, step=256
2025-08-05 14:15:58,461 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-308.000, offset=9, step=256
2025-08-05 14:15:58,463 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=180.000, offset=9, step=256
2025-08-05 14:15:58,464 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1120.000, offset=9, step=256
2025-08-05 14:15:58,465 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-644.000, offset=9, step=256
2025-08-05 14:15:58,466 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1200.000, offset=9, step=256
2025-08-05 14:15:58,468 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.468750, var=6944.000000, max_abs=1904.000000 [CRITICAL][0m
2025-08-05 14:15:58,468 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1904.000000[0m
2025-08-05 14:15:58,468 - [__main__] Rank 1 - ERROR - First 10 values: [51.5, 125.0, -66.0, -2.75, -4.625, -27.25, -20.0, -5.125, -24.625, 19.0]
2025-08-05 14:15:58,469 - [__main__] Rank 1 - ERROR -   Index 1793: value=1904.000000
2025-08-05 14:15:58,469 - [__main__] Rank 1 - ERROR -   Index 1683: value=1592.000000
2025-08-05 14:15:58,469 - [__main__] Rank 1 - ERROR -   Index 1999: value=1456.000000
2025-08-05 14:15:58,469 - [__main__] Rank 1 - ERROR -   Index 307: value=416.000000
2025-08-05 14:15:58,469 - [__main__] Rank 1 - ERROR -   Index 1371: value=-296.000000
2025-08-05 14:15:58,471 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-1.757812, var=3952.000000, max_abs=736.000000 [CRITICAL][0m
2025-08-05 14:15:58,471 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=736.000000[0m
2025-08-05 14:15:58,471 - [__main__] Rank 1 - ERROR - First 10 values: [49.5, 65.0, -29.875, 36.5, -35.75, -32.5, -24.375, 14.875, -31.0, 10.5]
2025-08-05 14:15:58,471 - [__main__] Rank 1 - ERROR -   Index 1793: value=736.000000
2025-08-05 14:15:58,472 - [__main__] Rank 1 - ERROR -   Index 307: value=428.000000
2025-08-05 14:15:58,472 - [__main__] Rank 1 - ERROR -   Index 1683: value=364.000000
2025-08-05 14:15:58,472 - [__main__] Rank 1 - ERROR -   Index 47: value=284.000000
2025-08-05 14:15:58,473 - [__main__] Rank 1 - ERROR -   Index 1446: value=268.000000
2025-08-05 14:15:58,473 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=412.000, offset=9, step=256
2025-08-05 14:15:58,473 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=9 L15:off=9 L16:off=9 L17:off=9 L18:off=9 L19:off=9 L20:off=9 L21:off=9 L22:off=9 L23:off=9 L24:off=9 L25:off=9 L26:off=9 L27:off=9
2025-08-05 14:15:58,473 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=a91d3ec8ebf5b99b, norm=2848.000, first_4=[49.5, 65.0, -29.875, 36.5], checksum=-3600.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:15:58,476 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 65.000000, values=[49.5, 65.0, -29.875, 36.5]...
2025-08-05 14:15:58,476 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=1b4d6dfc1b21d821, data size=3308 bytes
2025-08-05 14:15:58,476 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:15:58,489 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:15:58,489 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:15:58,490 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: a91d3ec8ebf5b99b, size=3308
2025-08-05 14:15:58,842 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:58,842 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3330 bytes
2025-08-05 14:15:58,842 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3330
2025-08-05 14:15:58,842 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 7d2e5ced23a69a2d, size=3330
2025-08-05 14:15:58,842 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=7d2e5ced23a69a2d, metadata checksum=NO_CHECKSUM
2025-08-05 14:15:58,846 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 12.562500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 12.562500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,850 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 12.562500, values=[4.6875, 12.5625, -4.375, -0.34765625]...
2025-08-05 14:15:58,851 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=7d2e5ced23a69a2d, norm=151.000, first_4=[4.6875, 12.5625, -4.375, -0.34765625], checksum=148.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:15:58,859 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,863 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,867 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,870 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,875 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,879 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,883 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,888 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,892 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,897 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,902 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,906 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,911 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,915 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,919 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,923 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,927 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,931 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,934 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,938 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,942 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,947 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,951 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,954 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,960 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,966 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,972 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,976 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=9 L15:off=9 L16:off=9 L17:off=9 L18:off=9 L19:off=9 L20:off=9 L21:off=9 L22:off=9 L23:off=9 L24:off=9 L25:off=9 L26:off=9 L27:off=9
2025-08-05 14:15:58,977 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:15:58,978 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.072266, var=11.187500, max_abs=44.750000 [CRITICAL][0m
2025-08-05 14:15:58,978 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=44.750000[0m
2025-08-05 14:15:58,978 - [__main__] Rank 1 - ERROR - First 10 values: [4.6875, 12.5625, -4.375, -0.34765625, 0.52734375, 0.90625, -1.34375, -5.96875, 4.28125, -0.75]
2025-08-05 14:15:58,979 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.750000
2025-08-05 14:15:58,980 - [__main__] Rank 1 - ERROR -   Index 1371: value=-41.250000
2025-08-05 14:15:58,980 - [__main__] Rank 1 - ERROR -   Index 1793: value=-35.750000
2025-08-05 14:15:58,980 - [__main__] Rank 1 - ERROR -   Index 940: value=28.000000
2025-08-05 14:15:58,980 - [__main__] Rank 1 - ERROR -   Index 331: value=19.625000
2025-08-05 14:15:58,982 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.130859, var=14.875000, max_abs=52.250000 [CRITICAL][0m
2025-08-05 14:15:58,982 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=52.250000[0m
2025-08-05 14:15:58,982 - [__main__] Rank 1 - ERROR - First 10 values: [2.0625, 18.75, -5.84375, 1.828125, -2.609375, 0.9140625, -0.08984375, -5.0625, 3.671875, -0.35546875]
2025-08-05 14:15:58,982 - [__main__] Rank 1 - ERROR -   Index 1371: value=-52.250000
2025-08-05 14:15:58,983 - [__main__] Rank 1 - ERROR -   Index 1999: value=46.750000
2025-08-05 14:15:58,983 - [__main__] Rank 1 - ERROR -   Index 1793: value=-36.750000
2025-08-05 14:15:58,983 - [__main__] Rank 1 - ERROR -   Index 940: value=36.000000
2025-08-05 14:15:58,984 - [__main__] Rank 1 - ERROR -   Index 331: value=28.625000
2025-08-05 14:15:58,984 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=876.000, offset=10, step=256
2025-08-05 14:15:58,984 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=20.000, offset=10, step=256
2025-08-05 14:15:58,986 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=420.000, offset=10, step=256
2025-08-05 14:15:58,987 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1664.000, offset=10, step=256
2025-08-05 14:15:58,988 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=241.000, offset=10, step=256
2025-08-05 14:15:58,990 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1216.000, offset=10, step=256
2025-08-05 14:15:58,991 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=936.000, offset=10, step=256
2025-08-05 14:15:58,992 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-66.500, offset=10, step=256
2025-08-05 14:15:58,993 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-328.000, offset=10, step=256
2025-08-05 14:15:58,994 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=156.000, offset=10, step=256
2025-08-05 14:15:58,995 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1224.000, offset=10, step=256
2025-08-05 14:15:58,996 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-788.000, offset=10, step=256
2025-08-05 14:15:58,997 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1320.000, offset=10, step=256
2025-08-05 14:15:58,998 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=2.312500, var=7616.000000, max_abs=2016.000000 [CRITICAL][0m
2025-08-05 14:15:58,998 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2016.000000[0m
2025-08-05 14:15:58,998 - [__main__] Rank 1 - ERROR - First 10 values: [45.25, 76.0, -60.75, -12.375, 9.375, -64.5, 3.125, 8.625, -34.0, 6.25]
2025-08-05 14:15:58,999 - [__main__] Rank 1 - ERROR -   Index 1793: value=2016.000000
2025-08-05 14:15:58,999 - [__main__] Rank 1 - ERROR -   Index 1683: value=1696.000000
2025-08-05 14:15:58,999 - [__main__] Rank 1 - ERROR -   Index 1999: value=1680.000000
2025-08-05 14:15:58,999 - [__main__] Rank 1 - ERROR -   Index 307: value=416.000000
2025-08-05 14:15:59,000 - [__main__] Rank 1 - ERROR -   Index 1960: value=-340.000000
2025-08-05 14:15:59,002 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.062256, var=4128.000000, max_abs=896.000000 [CRITICAL][0m
2025-08-05 14:15:59,002 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=896.000000[0m
2025-08-05 14:15:59,002 - [__main__] Rank 1 - ERROR - First 10 values: [36.0, 21.0, -18.125, 16.375, -15.25, -61.5, 4.375, 31.75, -61.25, 24.5]
2025-08-05 14:15:59,002 - [__main__] Rank 1 - ERROR -   Index 1793: value=896.000000
2025-08-05 14:15:59,003 - [__main__] Rank 1 - ERROR -   Index 1683: value=468.000000
2025-08-05 14:15:59,003 - [__main__] Rank 1 - ERROR -   Index 1999: value=448.000000
2025-08-05 14:15:59,003 - [__main__] Rank 1 - ERROR -   Index 307: value=416.000000
2025-08-05 14:15:59,004 - [__main__] Rank 1 - ERROR -   Index 1960: value=-370.000000
2025-08-05 14:15:59,005 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=468.000, offset=10, step=256
2025-08-05 14:15:59,005 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=10 L15:off=10 L16:off=10 L17:off=10 L18:off=10 L19:off=10 L20:off=10 L21:off=10 L22:off=10 L23:off=10 L24:off=10 L25:off=10 L26:off=10 L27:off=10
2025-08-05 14:15:59,006 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=0c3a5bb8423d255f, norm=2912.000, first_4=[36.0, 21.0, -18.125, 16.375], checksum=127.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:15:59,009 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 64.000000, values=[36.0, 21.0, -18.125, 16.375]...
2025-08-05 14:15:59,009 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=99c050a11d43b1e7, data size=3301 bytes
2025-08-05 14:15:59,009 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:15:59,023 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:15:59,023 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:15:59,024 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 0c3a5bb8423d255f, size=3301
2025-08-05 14:15:59,378 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:59,378 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3346 bytes
2025-08-05 14:15:59,378 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3346
2025-08-05 14:15:59,378 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: e081448e4e63645b, size=3346
2025-08-05 14:15:59,378 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=e081448e4e63645b, metadata checksum=NO_CHECKSUM
2025-08-05 14:15:59,383 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 12.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 12.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,387 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 12.000000, values=[4.6875, 12.0, -4.0625, 1.3359375]...
2025-08-05 14:15:59,387 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=e081448e4e63645b, norm=156.000, first_4=[4.6875, 12.0, -4.0625, 1.3359375], checksum=22.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:15:59,395 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,400 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,404 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,407 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,410 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,415 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,419 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,422 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,426 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,429 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,432 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,435 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,438 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,442 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,446 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,450 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,455 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,458 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,464 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,468 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,472 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,476 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,480 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,484 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,488 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,491 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,495 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,499 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=10 L15:off=10 L16:off=10 L17:off=10 L18:off=10 L19:off=10 L20:off=10 L21:off=10 L22:off=10 L23:off=10 L24:off=10 L25:off=10 L26:off=10 L27:off=10
2025-08-05 14:15:59,500 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:15:59,501 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.010986, var=11.812500, max_abs=42.250000 [CRITICAL][0m
2025-08-05 14:15:59,501 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=42.250000[0m
2025-08-05 14:15:59,501 - [__main__] Rank 1 - ERROR - First 10 values: [4.6875, 12.0, -4.0625, 1.3359375, 1.078125, -0.90234375, -1.2421875, -5.0, 4.0, -4.875]
2025-08-05 14:15:59,501 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.250000
2025-08-05 14:15:59,501 - [__main__] Rank 1 - ERROR -   Index 1999: value=42.000000
2025-08-05 14:15:59,501 - [__main__] Rank 1 - ERROR -   Index 1793: value=-33.000000
2025-08-05 14:15:59,502 - [__main__] Rank 1 - ERROR -   Index 940: value=29.500000
2025-08-05 14:15:59,502 - [__main__] Rank 1 - ERROR -   Index 559: value=-21.375000
2025-08-05 14:15:59,504 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.053223, var=15.375000, max_abs=53.500000 [CRITICAL][0m
2025-08-05 14:15:59,504 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.500000[0m
2025-08-05 14:15:59,504 - [__main__] Rank 1 - ERROR - First 10 values: [2.0625, 18.5, -4.9375, 3.625, -2.25, -0.3984375, 0.044921875, -3.5, 4.1875, -4.71875]
2025-08-05 14:15:59,504 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.500000
2025-08-05 14:15:59,505 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.500000
2025-08-05 14:15:59,505 - [__main__] Rank 1 - ERROR -   Index 940: value=37.250000
2025-08-05 14:15:59,505 - [__main__] Rank 1 - ERROR -   Index 1793: value=-32.000000
2025-08-05 14:15:59,505 - [__main__] Rank 1 - ERROR -   Index 331: value=26.500000
2025-08-05 14:15:59,506 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=996.000, offset=11, step=256
2025-08-05 14:15:59,506 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-37.000, offset=11, step=256
2025-08-05 14:15:59,507 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=448.000, offset=11, step=256
2025-08-05 14:15:59,508 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1848.000, offset=11, step=256
2025-08-05 14:15:59,510 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=246.000, offset=11, step=256
2025-08-05 14:15:59,512 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1368.000, offset=11, step=256
2025-08-05 14:15:59,513 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1064.000, offset=11, step=256
2025-08-05 14:15:59,514 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-14.750, offset=11, step=256
2025-08-05 14:15:59,516 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-364.000, offset=11, step=256
2025-08-05 14:15:59,517 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=125.500, offset=11, step=256
2025-08-05 14:15:59,518 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1360.000, offset=11, step=256
2025-08-05 14:15:59,519 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-880.000, offset=11, step=256
2025-08-05 14:15:59,520 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1472.000, offset=11, step=256
2025-08-05 14:15:59,522 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=2.078125, var=7616.000000, max_abs=2040.000000 [CRITICAL][0m
2025-08-05 14:15:59,522 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2040.000000[0m
2025-08-05 14:15:59,522 - [__main__] Rank 1 - ERROR - First 10 values: [55.25, 79.0, -78.0, -6.25, 3.59375, -62.25, -9.375, -7.34375, -17.75, 8.25]
2025-08-05 14:15:59,523 - [__main__] Rank 1 - ERROR -   Index 1793: value=2040.000000
2025-08-05 14:15:59,523 - [__main__] Rank 1 - ERROR -   Index 1683: value=1744.000000
2025-08-05 14:15:59,523 - [__main__] Rank 1 - ERROR -   Index 1999: value=1704.000000
2025-08-05 14:15:59,523 - [__main__] Rank 1 - ERROR -   Index 307: value=402.000000
2025-08-05 14:15:59,523 - [__main__] Rank 1 - ERROR -   Index 1960: value=-352.000000
2025-08-05 14:15:59,525 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.065430, var=4224.000000, max_abs=1040.000000 [CRITICAL][0m
2025-08-05 14:15:59,525 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1040.000000[0m
2025-08-05 14:15:59,525 - [__main__] Rank 1 - ERROR - First 10 values: [54.5, 47.0, -36.5, 26.0, -21.75, -58.5, -6.0, 18.0, -41.0, 14.0]
2025-08-05 14:15:59,525 - [__main__] Rank 1 - ERROR -   Index 1793: value=1040.000000
2025-08-05 14:15:59,526 - [__main__] Rank 1 - ERROR -   Index 1683: value=632.000000
2025-08-05 14:15:59,526 - [__main__] Rank 1 - ERROR -   Index 1999: value=604.000000
2025-08-05 14:15:59,526 - [__main__] Rank 1 - ERROR -   Index 1960: value=-390.000000
2025-08-05 14:15:59,526 - [__main__] Rank 1 - ERROR -   Index 307: value=386.000000
2025-08-05 14:15:59,527 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=512.000, offset=11, step=256
2025-08-05 14:15:59,527 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=11 L15:off=11 L16:off=11 L17:off=11 L18:off=11 L19:off=11 L20:off=11 L21:off=11 L22:off=11 L23:off=11 L24:off=11 L25:off=11 L26:off=11 L27:off=11
2025-08-05 14:15:59,527 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=2f6f5c2a6722633c, norm=2944.000, first_4=[54.5, 47.0, -36.5, 26.0], checksum=134.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:15:59,532 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 58.500000, values=[54.5, 47.0, -36.5, 26.0]...
2025-08-05 14:15:59,532 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=a41c04b1d9fd343b, data size=3303 bytes
2025-08-05 14:15:59,532 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:15:59,547 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:15:59,547 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:15:59,549 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 2f6f5c2a6722633c, size=3303
2025-08-05 14:15:59,883 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:15:59,883 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3340 bytes
2025-08-05 14:15:59,883 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3340
2025-08-05 14:15:59,883 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: d945ea129cf47c99, size=3340
2025-08-05 14:15:59,883 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=d945ea129cf47c99, metadata checksum=NO_CHECKSUM
2025-08-05 14:15:59,887 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 13.312500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 13.312500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,890 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 13.312500, values=[3.578125, 13.3125, -4.46875, 0.65625]...
2025-08-05 14:15:59,891 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=d945ea129cf47c99, norm=153.000, first_4=[3.578125, 13.3125, -4.46875, 0.65625], checksum=20.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:15:59,900 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,904 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,908 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,912 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,916 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,919 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,922 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,925 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,930 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,933 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,937 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,941 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,945 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,950 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,953 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,957 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,961 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,965 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,968 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,972 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,976 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,980 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,984 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,988 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,991 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,994 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:15:59,997 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,001 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=11 L15:off=11 L16:off=11 L17:off=11 L18:off=11 L19:off=11 L20:off=11 L21:off=11 L22:off=11 L23:off=11 L24:off=11 L25:off=11 L26:off=11 L27:off=11
2025-08-05 14:16:00,002 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:00,003 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.009766, var=11.500000, max_abs=43.000000 [CRITICAL][0m
2025-08-05 14:16:00,003 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=43.000000[0m
2025-08-05 14:16:00,003 - [__main__] Rank 1 - ERROR - First 10 values: [3.578125, 13.3125, -4.46875, 0.65625, -1.703125, -2.46875, -1.1875, -4.53125, 3.15625, 1.7421875]
2025-08-05 14:16:00,003 - [__main__] Rank 1 - ERROR -   Index 1371: value=-43.000000
2025-08-05 14:16:00,004 - [__main__] Rank 1 - ERROR -   Index 1999: value=42.000000
2025-08-05 14:16:00,004 - [__main__] Rank 1 - ERROR -   Index 1793: value=-35.250000
2025-08-05 14:16:00,004 - [__main__] Rank 1 - ERROR -   Index 940: value=29.625000
2025-08-05 14:16:00,005 - [__main__] Rank 1 - ERROR -   Index 641: value=22.750000
2025-08-05 14:16:00,006 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.065430, var=14.875000, max_abs=54.000000 [CRITICAL][0m
2025-08-05 14:16:00,006 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=54.000000[0m
2025-08-05 14:16:00,006 - [__main__] Rank 1 - ERROR - First 10 values: [1.703125, 20.25, -5.15625, 1.4140625, -5.34375, -0.859375, -1.1953125, -2.9375, 4.375, 2.328125]
2025-08-05 14:16:00,007 - [__main__] Rank 1 - ERROR -   Index 1371: value=-54.000000
2025-08-05 14:16:00,007 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.250000
2025-08-05 14:16:00,007 - [__main__] Rank 1 - ERROR -   Index 940: value=37.250000
2025-08-05 14:16:00,007 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.250000
2025-08-05 14:16:00,007 - [__main__] Rank 1 - ERROR -   Index 331: value=25.625000
2025-08-05 14:16:00,008 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1080.000, offset=12, step=256
2025-08-05 14:16:00,008 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-92.000, offset=12, step=256
2025-08-05 14:16:00,009 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=472.000, offset=12, step=256
2025-08-05 14:16:00,011 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2048.000, offset=12, step=256
2025-08-05 14:16:00,012 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=236.000, offset=12, step=256
2025-08-05 14:16:00,014 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1520.000, offset=12, step=256
2025-08-05 14:16:00,015 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1176.000, offset=12, step=256
2025-08-05 14:16:00,016 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=25.750, offset=12, step=256
2025-08-05 14:16:00,017 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-412.000, offset=12, step=256
2025-08-05 14:16:00,018 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=102.500, offset=12, step=256
2025-08-05 14:16:00,019 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1488.000, offset=12, step=256
2025-08-05 14:16:00,021 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1024.000, offset=12, step=256
2025-08-05 14:16:00,022 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1656.000, offset=12, step=256
2025-08-05 14:16:00,023 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.242188, var=8448.000000, max_abs=2144.000000 [CRITICAL][0m
2025-08-05 14:16:00,023 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2144.000000[0m
2025-08-05 14:16:00,023 - [__main__] Rank 1 - ERROR - First 10 values: [23.375, 43.5, -153.0, 11.1875, -32.75, -21.0, -19.125, 10.5625, 18.25, 19.0]
2025-08-05 14:16:00,023 - [__main__] Rank 1 - ERROR -   Index 1793: value=2144.000000
2025-08-05 14:16:00,024 - [__main__] Rank 1 - ERROR -   Index 1683: value=1872.000000
2025-08-05 14:16:00,024 - [__main__] Rank 1 - ERROR -   Index 1999: value=1848.000000
2025-08-05 14:16:00,024 - [__main__] Rank 1 - ERROR -   Index 307: value=392.000000
2025-08-05 14:16:00,024 - [__main__] Rank 1 - ERROR -   Index 1960: value=-358.000000
2025-08-05 14:16:00,027 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.400391, var=5792.000000, max_abs=1424.000000 [CRITICAL][0m
2025-08-05 14:16:00,027 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1424.000000[0m
2025-08-05 14:16:00,027 - [__main__] Rank 1 - ERROR - First 10 values: [14.75, 16.75, -121.5, 43.75, -44.75, -27.5, -17.75, 34.0, -1.125, 40.25]
2025-08-05 14:16:00,027 - [__main__] Rank 1 - ERROR -   Index 1793: value=1424.000000
2025-08-05 14:16:00,027 - [__main__] Rank 1 - ERROR -   Index 1999: value=1024.000000
2025-08-05 14:16:00,028 - [__main__] Rank 1 - ERROR -   Index 1683: value=1020.000000
2025-08-05 14:16:00,028 - [__main__] Rank 1 - ERROR -   Index 1960: value=-460.000000
2025-08-05 14:16:00,028 - [__main__] Rank 1 - ERROR -   Index 1321: value=-384.000000
2025-08-05 14:16:00,029 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=544.000, offset=12, step=256
2025-08-05 14:16:00,029 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=12 L15:off=12 L16:off=12 L17:off=12 L18:off=12 L19:off=12 L20:off=12 L21:off=12 L22:off=12 L23:off=12 L24:off=12 L25:off=12 L26:off=12 L27:off=12
2025-08-05 14:16:00,030 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=2b3b1ecb7d89b95e, norm=3440.000, first_4=[14.75, 16.75, -121.5, 43.75], checksum=-820.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:00,034 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 121.500000, values=[14.75, 16.75, -121.5, 43.75]...
2025-08-05 14:16:00,034 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=3ee6706cc16c3c3d, data size=3310 bytes
2025-08-05 14:16:00,034 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:00,045 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:00,045 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:00,047 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 2b3b1ecb7d89b95e, size=3310
2025-08-05 14:16:00,396 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:00,396 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3339 bytes
2025-08-05 14:16:00,396 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3339
2025-08-05 14:16:00,396 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: dac58471302fac59, size=3339
2025-08-05 14:16:00,396 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=dac58471302fac59, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:00,399 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.781250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.781250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,403 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 7.781250, values=[3.875, 7.78125, -1.6171875, -3.28125]...
2025-08-05 14:16:00,403 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=dac58471302fac59, norm=164.000, first_4=[3.875, 7.78125, -1.6171875, -3.28125], checksum=70.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:00,412 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,416 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,423 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,428 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,434 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,438 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,442 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,447 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,451 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,455 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,459 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,463 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,466 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,469 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,473 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,476 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,481 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,484 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,489 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,492 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,497 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,501 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,505 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,509 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,513 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,516 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,520 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,524 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=12 L15:off=12 L16:off=12 L17:off=12 L18:off=12 L19:off=12 L20:off=12 L21:off=12 L22:off=12 L23:off=12 L24:off=12 L25:off=12 L26:off=12 L27:off=12
2025-08-05 14:16:00,525 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:00,526 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.034424, var=13.125000, max_abs=42.500000 [CRITICAL][0m
2025-08-05 14:16:00,526 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=42.500000[0m
2025-08-05 14:16:00,526 - [__main__] Rank 1 - ERROR - First 10 values: [3.875, 7.78125, -1.6171875, -3.28125, -2.078125, -1.328125, -2.09375, -4.59375, 4.78125, 6.78125]
2025-08-05 14:16:00,526 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.500000
2025-08-05 14:16:00,526 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.500000
2025-08-05 14:16:00,527 - [__main__] Rank 1 - ERROR -   Index 641: value=30.750000
2025-08-05 14:16:00,527 - [__main__] Rank 1 - ERROR -   Index 940: value=26.125000
2025-08-05 14:16:00,528 - [__main__] Rank 1 - ERROR -   Index 1308: value=-21.375000
2025-08-05 14:16:00,530 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.053711, var=17.250000, max_abs=53.000000 [CRITICAL][0m
2025-08-05 14:16:00,530 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.000000[0m
2025-08-05 14:16:00,530 - [__main__] Rank 1 - ERROR - First 10 values: [2.21875, 10.75, -1.796875, -2.859375, -5.15625, 0.005859375, -3.15625, -5.09375, 6.5, 6.84375]
2025-08-05 14:16:00,530 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.000000
2025-08-05 14:16:00,530 - [__main__] Rank 1 - ERROR -   Index 1999: value=39.500000
2025-08-05 14:16:00,531 - [__main__] Rank 1 - ERROR -   Index 1793: value=-39.000000
2025-08-05 14:16:00,531 - [__main__] Rank 1 - ERROR -   Index 940: value=34.750000
2025-08-05 14:16:00,532 - [__main__] Rank 1 - ERROR -   Index 641: value=32.500000
2025-08-05 14:16:00,532 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1144.000, offset=13, step=256
2025-08-05 14:16:00,532 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-158.000, offset=13, step=256
2025-08-05 14:16:00,534 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=454.000, offset=13, step=256
2025-08-05 14:16:00,535 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2240.000, offset=13, step=256
2025-08-05 14:16:00,536 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=244.000, offset=13, step=256
2025-08-05 14:16:00,537 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1648.000, offset=13, step=256
2025-08-05 14:16:00,539 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1232.000, offset=13, step=256
2025-08-05 14:16:00,540 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-5.500, offset=13, step=256
2025-08-05 14:16:00,541 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-420.000, offset=13, step=256
2025-08-05 14:16:00,542 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=150.000, offset=13, step=256
2025-08-05 14:16:00,543 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1528.000, offset=13, step=256
2025-08-05 14:16:00,545 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1128.000, offset=13, step=256
2025-08-05 14:16:00,546 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1792.000, offset=13, step=256
2025-08-05 14:16:00,548 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.289062, var=6560.000000, max_abs=1856.000000 [CRITICAL][0m
2025-08-05 14:16:00,548 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1856.000000[0m
2025-08-05 14:16:00,548 - [__main__] Rank 1 - ERROR - First 10 values: [15.25, 102.0, -45.0, -22.875, -68.5, -44.0, -25.875, -6.5, 32.75, 37.75]
2025-08-05 14:16:00,548 - [__main__] Rank 1 - ERROR -   Index 1793: value=1856.000000
2025-08-05 14:16:00,548 - [__main__] Rank 1 - ERROR -   Index 1683: value=1632.000000
2025-08-05 14:16:00,549 - [__main__] Rank 1 - ERROR -   Index 1999: value=1360.000000
2025-08-05 14:16:00,549 - [__main__] Rank 1 - ERROR -   Index 307: value=330.000000
2025-08-05 14:16:00,549 - [__main__] Rank 1 - ERROR -   Index 1371: value=-320.000000
2025-08-05 14:16:00,551 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.750000, var=5376.000000, max_abs=1472.000000 [CRITICAL][0m
2025-08-05 14:16:00,551 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1472.000000[0m
2025-08-05 14:16:00,551 - [__main__] Rank 1 - ERROR - First 10 values: [25.5, 66.0, -22.5, 19.375, -107.0, -35.75, -12.125, 14.4375, 27.125, 41.0]
2025-08-05 14:16:00,551 - [__main__] Rank 1 - ERROR -   Index 1793: value=1472.000000
2025-08-05 14:16:00,552 - [__main__] Rank 1 - ERROR -   Index 1683: value=1064.000000
2025-08-05 14:16:00,552 - [__main__] Rank 1 - ERROR -   Index 1999: value=884.000000
2025-08-05 14:16:00,552 - [__main__] Rank 1 - ERROR -   Index 307: value=304.000000
2025-08-05 14:16:00,553 - [__main__] Rank 1 - ERROR -   Index 47: value=298.000000
2025-08-05 14:16:00,553 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=612.000, offset=13, step=256
2025-08-05 14:16:00,553 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=13 L15:off=13 L16:off=13 L17:off=13 L18:off=13 L19:off=13 L20:off=13 L21:off=13 L22:off=13 L23:off=13 L24:off=13 L25:off=13 L26:off=13 L27:off=13
2025-08-05 14:16:00,554 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=df7599ee925e9676, norm=3312.000, first_4=[25.5, 66.0, -22.5, 19.375], checksum=-1536.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:00,557 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 107.000000, values=[25.5, 66.0, -22.5, 19.375]...
2025-08-05 14:16:00,558 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=e9287398ac2d4ff0, data size=3310 bytes
2025-08-05 14:16:00,558 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:00,569 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:00,569 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:00,571 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: df7599ee925e9676, size=3310
2025-08-05 14:16:00,918 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:00,918 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3336 bytes
2025-08-05 14:16:00,918 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3336
2025-08-05 14:16:00,918 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: c01c3619ef325d63, size=3336
2025-08-05 14:16:00,918 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=c01c3619ef325d63, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:00,922 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.781250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.781250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,928 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 5.781250, values=[3.78125, 4.96875, -2.078125, -1.109375]...
2025-08-05 14:16:00,928 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=c01c3619ef325d63, norm=149.000, first_4=[3.78125, 4.96875, -2.078125, -1.109375], checksum=29.875000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:00,937 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,941 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,948 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,953 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,958 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,961 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,965 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,969 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,973 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,978 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,983 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,987 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,991 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,994 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:00,999 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,003 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,007 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,012 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,017 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,021 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,024 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,026 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,030 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,034 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,038 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,042 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,047 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,051 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=13 L15:off=13 L16:off=13 L17:off=13 L18:off=13 L19:off=13 L20:off=13 L21:off=13 L22:off=13 L23:off=13 L24:off=13 L25:off=13 L26:off=13 L27:off=13
2025-08-05 14:16:01,052 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:01,053 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.014587, var=10.875000, max_abs=41.250000 [CRITICAL][0m
2025-08-05 14:16:01,053 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=41.250000[0m
2025-08-05 14:16:01,053 - [__main__] Rank 1 - ERROR - First 10 values: [3.78125, 4.96875, -2.078125, -1.109375, -3.46875, -1.65625, -1.5234375, -4.40625, 5.78125, 1.859375]
2025-08-05 14:16:01,054 - [__main__] Rank 1 - ERROR -   Index 1371: value=-41.250000
2025-08-05 14:16:01,054 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.500000
2025-08-05 14:16:01,054 - [__main__] Rank 1 - ERROR -   Index 1999: value=32.750000
2025-08-05 14:16:01,055 - [__main__] Rank 1 - ERROR -   Index 641: value=28.375000
2025-08-05 14:16:01,055 - [__main__] Rank 1 - ERROR -   Index 940: value=22.375000
2025-08-05 14:16:01,057 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.028809, var=14.750000, max_abs=51.250000 [CRITICAL][0m
2025-08-05 14:16:01,057 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=51.250000[0m
2025-08-05 14:16:01,057 - [__main__] Rank 1 - ERROR - First 10 values: [1.34375, 6.5, -2.828125, 0.4375, -6.53125, -0.8515625, -0.546875, -5.03125, 8.5625, 2.53125]
2025-08-05 14:16:01,057 - [__main__] Rank 1 - ERROR -   Index 1371: value=-51.250000
2025-08-05 14:16:01,057 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.500000
2025-08-05 14:16:01,058 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.250000
2025-08-05 14:16:01,058 - [__main__] Rank 1 - ERROR -   Index 641: value=30.125000
2025-08-05 14:16:01,058 - [__main__] Rank 1 - ERROR -   Index 940: value=29.500000
2025-08-05 14:16:01,058 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1240.000, offset=14, step=256
2025-08-05 14:16:01,058 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-205.000, offset=14, step=256
2025-08-05 14:16:01,059 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=460.000, offset=14, step=256
2025-08-05 14:16:01,061 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2432.000, offset=14, step=256
2025-08-05 14:16:01,062 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=252.000, offset=14, step=256
2025-08-05 14:16:01,063 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1752.000, offset=14, step=256
2025-08-05 14:16:01,064 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1360.000, offset=14, step=256
2025-08-05 14:16:01,065 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-8.500, offset=14, step=256
2025-08-05 14:16:01,066 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-398.000, offset=14, step=256
2025-08-05 14:16:01,067 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=210.000, offset=14, step=256
2025-08-05 14:16:01,069 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1592.000, offset=14, step=256
2025-08-05 14:16:01,070 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1208.000, offset=14, step=256
2025-08-05 14:16:01,071 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1880.000, offset=14, step=256
2025-08-05 14:16:01,073 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=2.218750, var=7072.000000, max_abs=1976.000000 [CRITICAL][0m
2025-08-05 14:16:01,073 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1976.000000[0m
2025-08-05 14:16:01,073 - [__main__] Rank 1 - ERROR - First 10 values: [16.625, 85.5, -0.6875, -30.125, -6.625, -70.5, -18.0, 20.625, -20.375, 20.125]
2025-08-05 14:16:01,073 - [__main__] Rank 1 - ERROR -   Index 1793: value=1976.000000
2025-08-05 14:16:01,073 - [__main__] Rank 1 - ERROR -   Index 1683: value=1720.000000
2025-08-05 14:16:01,073 - [__main__] Rank 1 - ERROR -   Index 1999: value=1584.000000
2025-08-05 14:16:01,074 - [__main__] Rank 1 - ERROR -   Index 1960: value=-380.000000
2025-08-05 14:16:01,074 - [__main__] Rank 1 - ERROR -   Index 307: value=344.000000
2025-08-05 14:16:01,075 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.640625, var=4800.000000, max_abs=1328.000000 [CRITICAL][0m
2025-08-05 14:16:01,075 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1328.000000[0m
2025-08-05 14:16:01,075 - [__main__] Rank 1 - ERROR - First 10 values: [16.25, 44.0, 30.75, -9.75, -35.5, -55.5, -5.125, 48.25, -40.5, 43.0]
2025-08-05 14:16:01,076 - [__main__] Rank 1 - ERROR -   Index 1793: value=1328.000000
2025-08-05 14:16:01,076 - [__main__] Rank 1 - ERROR -   Index 1683: value=888.000000
2025-08-05 14:16:01,076 - [__main__] Rank 1 - ERROR -   Index 1999: value=820.000000
2025-08-05 14:16:01,076 - [__main__] Rank 1 - ERROR -   Index 1960: value=-464.000000
2025-08-05 14:16:01,076 - [__main__] Rank 1 - ERROR -   Index 47: value=348.000000
2025-08-05 14:16:01,077 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=680.000, offset=14, step=256
2025-08-05 14:16:01,077 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=14 L15:off=14 L16:off=14 L17:off=14 L18:off=14 L19:off=14 L20:off=14 L21:off=14 L22:off=14 L23:off=14 L24:off=14 L25:off=14 L26:off=14 L27:off=14
2025-08-05 14:16:01,078 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=d0204f491e324dcb, norm=3136.000, first_4=[16.25, 44.0, 30.75, -9.75], checksum=1312.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:01,081 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 55.500000, values=[16.25, 44.0, 30.75, -9.75]...
2025-08-05 14:16:01,081 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=9632b4238460f3f3, data size=3299 bytes
2025-08-05 14:16:01,081 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:01,094 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:01,094 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:01,096 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: d0204f491e324dcb, size=3299
2025-08-05 14:16:01,442 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:01,442 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3324 bytes
2025-08-05 14:16:01,442 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3324
2025-08-05 14:16:01,442 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 6991d6f6ecc9fdf0, size=3324
2025-08-05 14:16:01,442 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=6991d6f6ecc9fdf0, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:01,447 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.968750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.968750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,452 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 6.968750, values=[2.546875, 6.28125, -3.578125, 0.328125]...
2025-08-05 14:16:01,453 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=6991d6f6ecc9fdf0, norm=145.000, first_4=[2.546875, 6.28125, -3.578125, 0.328125], checksum=12.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:01,461 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,465 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,468 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,472 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,477 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,481 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,485 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,489 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,492 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,497 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,502 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,505 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,510 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,514 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,517 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,522 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,527 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,531 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,535 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,538 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,541 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,545 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,549 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,553 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,557 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,560 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,565 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,569 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,569 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:01,570 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:01,570 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:01,570 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:01,570 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=14 L15:off=14 L16:off=14 L17:off=14 L18:off=14 L19:off=14 L20:off=14 L21:off=14 L22:off=14 L23:off=14 L24:off=14 L25:off=14 L26:off=14 L27:off=14
2025-08-05 14:16:01,570 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:01,571 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.006104, var=10.250000, max_abs=45.000000 [CRITICAL][0m
2025-08-05 14:16:01,571 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=45.000000[0m
2025-08-05 14:16:01,571 - [__main__] Rank 1 - ERROR - First 10 values: [2.546875, 6.28125, -3.578125, 0.328125, -1.0859375, -1.625, -0.703125, -2.984375, 3.3125, -2.625]
2025-08-05 14:16:01,571 - [__main__] Rank 1 - ERROR -   Index 1371: value=-45.000000
2025-08-05 14:16:01,572 - [__main__] Rank 1 - ERROR -   Index 1999: value=38.000000
2025-08-05 14:16:01,572 - [__main__] Rank 1 - ERROR -   Index 1793: value=-33.500000
2025-08-05 14:16:01,572 - [__main__] Rank 1 - ERROR -   Index 641: value=31.125000
2025-08-05 14:16:01,572 - [__main__] Rank 1 - ERROR -   Index 940: value=21.250000
2025-08-05 14:16:01,574 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.004242, var=13.687500, max_abs=55.750000 [CRITICAL][0m
2025-08-05 14:16:01,574 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=55.750000[0m
2025-08-05 14:16:01,574 - [__main__] Rank 1 - ERROR - First 10 values: [0.1767578125, 8.875, -4.21875, 1.140625, -4.09375, -1.7265625, 1.7734375, -5.1875, 6.0, -2.296875]
2025-08-05 14:16:01,574 - [__main__] Rank 1 - ERROR -   Index 1371: value=-55.750000
2025-08-05 14:16:01,575 - [__main__] Rank 1 - ERROR -   Index 1999: value=46.250000
2025-08-05 14:16:01,575 - [__main__] Rank 1 - ERROR -   Index 641: value=32.750000
2025-08-05 14:16:01,575 - [__main__] Rank 1 - ERROR -   Index 1793: value=-31.875000
2025-08-05 14:16:01,575 - [__main__] Rank 1 - ERROR -   Index 940: value=27.375000
2025-08-05 14:16:01,575 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1288.000, offset=15, step=256
2025-08-05 14:16:01,576 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-262.000, offset=15, step=256
2025-08-05 14:16:01,577 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=462.000, offset=15, step=256
2025-08-05 14:16:01,578 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2624.000, offset=15, step=256
2025-08-05 14:16:01,580 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=276.000, offset=15, step=256
2025-08-05 14:16:01,581 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1864.000, offset=15, step=256
2025-08-05 14:16:01,583 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1504.000, offset=15, step=256
2025-08-05 14:16:01,584 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=53.500, offset=15, step=256
2025-08-05 14:16:01,585 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-388.000, offset=15, step=256
2025-08-05 14:16:01,587 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=248.000, offset=15, step=256
2025-08-05 14:16:01,588 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1688.000, offset=15, step=256
2025-08-05 14:16:01,589 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1256.000, offset=15, step=256
2025-08-05 14:16:01,590 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1984.000, offset=15, step=256
2025-08-05 14:16:01,591 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.664062, var=6976.000000, max_abs=1944.000000 [CRITICAL][0m
2025-08-05 14:16:01,591 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1944.000000[0m
2025-08-05 14:16:01,591 - [__main__] Rank 1 - ERROR - First 10 values: [19.25, 82.0, -8.5, -29.125, -14.875, -56.5, -15.375, 8.8125, -21.5, 19.5]
2025-08-05 14:16:01,592 - [__main__] Rank 1 - ERROR -   Index 1793: value=1944.000000
2025-08-05 14:16:01,592 - [__main__] Rank 1 - ERROR -   Index 1683: value=1760.000000
2025-08-05 14:16:01,592 - [__main__] Rank 1 - ERROR -   Index 1999: value=1600.000000
2025-08-05 14:16:01,592 - [__main__] Rank 1 - ERROR -   Index 1960: value=-338.000000
2025-08-05 14:16:01,593 - [__main__] Rank 1 - ERROR -   Index 307: value=328.000000
2025-08-05 14:16:01,594 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.361328, var=5056.000000, max_abs=1424.000000 [CRITICAL][0m
2025-08-05 14:16:01,594 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1424.000000[0m
2025-08-05 14:16:01,594 - [__main__] Rank 1 - ERROR - First 10 values: [17.125, 58.25, 24.125, -0.75, -42.0, -49.25, -6.5, 41.0, -33.25, 23.5]
2025-08-05 14:16:01,595 - [__main__] Rank 1 - ERROR -   Index 1793: value=1424.000000
2025-08-05 14:16:01,595 - [__main__] Rank 1 - ERROR -   Index 1683: value=1048.000000
2025-08-05 14:16:01,596 - [__main__] Rank 1 - ERROR -   Index 1999: value=976.000000
2025-08-05 14:16:01,596 - [__main__] Rank 1 - ERROR -   Index 1960: value=-392.000000
2025-08-05 14:16:01,596 - [__main__] Rank 1 - ERROR -   Index 1645: value=-310.000000
2025-08-05 14:16:01,596 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=740.000, offset=15, step=256
2025-08-05 14:16:01,596 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=15 L15:off=15 L16:off=15 L17:off=15 L18:off=15 L19:off=15 L20:off=15 L21:off=15 L22:off=15 L23:off=15 L24:off=15 L25:off=15 L26:off=15 L27:off=15
2025-08-05 14:16:01,597 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=bdc555f608d87515, norm=3216.000, first_4=[17.125, 58.25, 24.125, -0.75], checksum=740.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:01,600 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 58.250000, values=[17.125, 58.25, 24.125, -0.75]...
2025-08-05 14:16:01,600 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=b62404226ce789ba, data size=3305 bytes
2025-08-05 14:16:01,600 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:01,612 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:01,612 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:01,614 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: bdc555f608d87515, size=3305
2025-08-05 14:16:01,974 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:01,974 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3333 bytes
2025-08-05 14:16:01,974 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3333
2025-08-05 14:16:01,974 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 58272bb886aae5d3, size=3333
2025-08-05 14:16:01,974 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=58272bb886aae5d3, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:01,979 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.875000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.875000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,984 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 7.875000, values=[0.5390625, 7.875, -2.46875, -0.796875]...
2025-08-05 14:16:01,984 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=58272bb886aae5d3, norm=150.000, first_4=[0.5390625, 7.875, -2.46875, -0.796875], checksum=39.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:01,994 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:01,999 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,002 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,008 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,012 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,015 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,019 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,023 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,027 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,032 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,037 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,041 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,043 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,046 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,049 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,052 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,056 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,059 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,063 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,066 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,069 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,073 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,077 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,082 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,086 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,089 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,093 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,096 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=15 L15:off=15 L16:off=15 L17:off=15 L18:off=15 L19:off=15 L20:off=15 L21:off=15 L22:off=15 L23:off=15 L24:off=15 L25:off=15 L26:off=15 L27:off=15
2025-08-05 14:16:02,097 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:02,098 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.019287, var=10.937500, max_abs=46.500000 [CRITICAL][0m
2025-08-05 14:16:02,098 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=46.500000[0m
2025-08-05 14:16:02,098 - [__main__] Rank 1 - ERROR - First 10 values: [0.5390625, 7.875, -2.46875, -0.796875, -1.6796875, -0.59375, 0.6640625, -1.21875, 3.0625, 3.3125]
2025-08-05 14:16:02,098 - [__main__] Rank 1 - ERROR -   Index 1371: value=-46.500000
2025-08-05 14:16:02,098 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.000000
2025-08-05 14:16:02,099 - [__main__] Rank 1 - ERROR -   Index 641: value=37.000000
2025-08-05 14:16:02,099 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.250000
2025-08-05 14:16:02,099 - [__main__] Rank 1 - ERROR -   Index 940: value=19.250000
2025-08-05 14:16:02,101 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.018311, var=14.062500, max_abs=56.750000 [CRITICAL][0m
2025-08-05 14:16:02,101 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=56.750000[0m
2025-08-05 14:16:02,101 - [__main__] Rank 1 - ERROR - First 10 values: [-1.03125, 12.1875, -2.28125, -1.125, -3.453125, -0.2265625, 1.7890625, -4.28125, 5.53125, 3.6875]
2025-08-05 14:16:02,101 - [__main__] Rank 1 - ERROR -   Index 1371: value=-56.750000
2025-08-05 14:16:02,101 - [__main__] Rank 1 - ERROR -   Index 1999: value=42.750000
2025-08-05 14:16:02,102 - [__main__] Rank 1 - ERROR -   Index 641: value=38.750000
2025-08-05 14:16:02,102 - [__main__] Rank 1 - ERROR -   Index 1793: value=-31.750000
2025-08-05 14:16:02,102 - [__main__] Rank 1 - ERROR -   Index 940: value=25.000000
2025-08-05 14:16:02,103 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1344.000, offset=16, step=256
2025-08-05 14:16:02,103 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-310.000, offset=16, step=256
2025-08-05 14:16:02,104 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=456.000, offset=16, step=256
2025-08-05 14:16:02,105 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2816.000, offset=16, step=256
2025-08-05 14:16:02,106 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=274.000, offset=16, step=256
2025-08-05 14:16:02,108 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1968.000, offset=16, step=256
2025-08-05 14:16:02,109 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1656.000, offset=16, step=256
2025-08-05 14:16:02,110 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=95.500, offset=16, step=256
2025-08-05 14:16:02,111 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-376.000, offset=16, step=256
2025-08-05 14:16:02,112 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=282.000, offset=16, step=256
2025-08-05 14:16:02,113 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1824.000, offset=16, step=256
2025-08-05 14:16:02,114 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1344.000, offset=16, step=256
2025-08-05 14:16:02,115 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2080.000, offset=16, step=256
2025-08-05 14:16:02,116 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.550781, var=7712.000000, max_abs=2096.000000 [CRITICAL][0m
2025-08-05 14:16:02,117 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2096.000000[0m
2025-08-05 14:16:02,117 - [__main__] Rank 1 - ERROR - First 10 values: [-25.75, 43.0, -55.0, 2.328125, -13.25, -36.0, -26.75, 42.0, 15.625, 28.875]
2025-08-05 14:16:02,117 - [__main__] Rank 1 - ERROR -   Index 1793: value=2096.000000
2025-08-05 14:16:02,117 - [__main__] Rank 1 - ERROR -   Index 1683: value=1864.000000
2025-08-05 14:16:02,118 - [__main__] Rank 1 - ERROR -   Index 1999: value=1736.000000
2025-08-05 14:16:02,118 - [__main__] Rank 1 - ERROR -   Index 307: value=326.000000
2025-08-05 14:16:02,119 - [__main__] Rank 1 - ERROR -   Index 1960: value=-324.000000
2025-08-05 14:16:02,121 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-1.085938, var=5344.000000, max_abs=1464.000000 [CRITICAL][0m
2025-08-05 14:16:02,121 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1464.000000[0m
2025-08-05 14:16:02,121 - [__main__] Rank 1 - ERROR - First 10 values: [-22.5, 29.25, -32.5, 30.375, -16.75, -25.875, -19.125, 73.5, 0.25, 45.75]
2025-08-05 14:16:02,121 - [__main__] Rank 1 - ERROR -   Index 1793: value=1464.000000
2025-08-05 14:16:02,121 - [__main__] Rank 1 - ERROR -   Index 1683: value=1088.000000
2025-08-05 14:16:02,121 - [__main__] Rank 1 - ERROR -   Index 1999: value=1008.000000
2025-08-05 14:16:02,122 - [__main__] Rank 1 - ERROR -   Index 1960: value=-440.000000
2025-08-05 14:16:02,122 - [__main__] Rank 1 - ERROR -   Index 49: value=-348.000000
2025-08-05 14:16:02,122 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=764.000, offset=16, step=256
2025-08-05 14:16:02,122 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=16 L15:off=16 L16:off=16 L17:off=16 L18:off=16 L19:off=16 L20:off=16 L21:off=16 L22:off=16 L23:off=16 L24:off=16 L25:off=16 L26:off=16 L27:off=16
2025-08-05 14:16:02,123 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=41451d2298c05e2c, norm=3312.000, first_4=[-22.5, 29.25, -32.5, 30.375], checksum=-2224.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:02,127 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 73.500000, values=[-22.5, 29.25, -32.5, 30.375]...
2025-08-05 14:16:02,128 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=ba3ac017122aff31, data size=3323 bytes
2025-08-05 14:16:02,128 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:02,141 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:02,141 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:02,142 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 41451d2298c05e2c, size=3323
2025-08-05 14:16:02,531 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:02,531 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3334 bytes
2025-08-05 14:16:02,531 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3334
2025-08-05 14:16:02,531 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 9f2b8e9050e13693, size=3334
2025-08-05 14:16:02,531 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=9f2b8e9050e13693, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:02,536 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 9.125000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 9.125000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,539 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 9.125000, values=[3.5, 9.125, 1.0234375, -3.515625]...
2025-08-05 14:16:02,540 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=9f2b8e9050e13693, norm=151.000, first_4=[3.5, 9.125, 1.0234375, -3.515625], checksum=125.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:02,548 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,552 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,557 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,561 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,566 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,570 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,573 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,578 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,582 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,585 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,588 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,591 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,596 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,600 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,604 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,607 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,611 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,616 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,622 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,626 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,632 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,635 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,639 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,642 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,646 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,649 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,653 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,656 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=16 L15:off=16 L16:off=16 L17:off=16 L18:off=16 L19:off=16 L20:off=16 L21:off=16 L22:off=16 L23:off=16 L24:off=16 L25:off=16 L26:off=16 L27:off=16
2025-08-05 14:16:02,657 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:02,658 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.061279, var=11.125000, max_abs=45.000000 [CRITICAL][0m
2025-08-05 14:16:02,658 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=45.000000[0m
2025-08-05 14:16:02,658 - [__main__] Rank 1 - ERROR - First 10 values: [3.5, 9.125, 1.0234375, -3.515625, 0.6875, -0.3828125, 0.220703125, -0.6796875, 1.2421875, 3.03125]
2025-08-05 14:16:02,658 - [__main__] Rank 1 - ERROR -   Index 1371: value=-45.000000
2025-08-05 14:16:02,658 - [__main__] Rank 1 - ERROR -   Index 641: value=30.375000
2025-08-05 14:16:02,658 - [__main__] Rank 1 - ERROR -   Index 1793: value=-27.125000
2025-08-05 14:16:02,659 - [__main__] Rank 1 - ERROR -   Index 1999: value=24.000000
2025-08-05 14:16:02,659 - [__main__] Rank 1 - ERROR -   Index 907: value=-21.500000
2025-08-05 14:16:02,660 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.104980, var=14.687500, max_abs=57.250000 [CRITICAL][0m
2025-08-05 14:16:02,661 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=57.250000[0m
2025-08-05 14:16:02,661 - [__main__] Rank 1 - ERROR - First 10 values: [1.921875, 12.8125, 2.21875, -0.3984375, -2.15625, -0.21484375, 1.453125, -2.203125, 4.40625, 2.875]
2025-08-05 14:16:02,661 - [__main__] Rank 1 - ERROR -   Index 1371: value=-57.250000
2025-08-05 14:16:02,662 - [__main__] Rank 1 - ERROR -   Index 1999: value=35.500000
2025-08-05 14:16:02,662 - [__main__] Rank 1 - ERROR -   Index 641: value=33.250000
2025-08-05 14:16:02,662 - [__main__] Rank 1 - ERROR -   Index 1793: value=-30.250000
2025-08-05 14:16:02,663 - [__main__] Rank 1 - ERROR -   Index 940: value=26.750000
2025-08-05 14:16:02,663 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1440.000, offset=17, step=256
2025-08-05 14:16:02,663 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-360.000, offset=17, step=256
2025-08-05 14:16:02,665 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=436.000, offset=17, step=256
2025-08-05 14:16:02,666 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3024.000, offset=17, step=256
2025-08-05 14:16:02,667 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=308.000, offset=17, step=256
2025-08-05 14:16:02,668 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2032.000, offset=17, step=256
2025-08-05 14:16:02,669 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1752.000, offset=17, step=256
2025-08-05 14:16:02,670 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=111.500, offset=17, step=256
2025-08-05 14:16:02,671 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-366.000, offset=17, step=256
2025-08-05 14:16:02,672 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=362.000, offset=17, step=256
2025-08-05 14:16:02,673 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1896.000, offset=17, step=256
2025-08-05 14:16:02,674 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1432.000, offset=17, step=256
2025-08-05 14:16:02,675 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2224.000, offset=17, step=256
2025-08-05 14:16:02,677 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.277344, var=6464.000000, max_abs=1872.000000 [CRITICAL][0m
2025-08-05 14:16:02,677 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1872.000000[0m
2025-08-05 14:16:02,677 - [__main__] Rank 1 - ERROR - First 10 values: [54.25, 95.0, -54.5, -1.9375, -32.25, -25.5, -33.75, 21.5, 9.9375, 13.3125]
2025-08-05 14:16:02,677 - [__main__] Rank 1 - ERROR -   Index 1793: value=1872.000000
2025-08-05 14:16:02,678 - [__main__] Rank 1 - ERROR -   Index 1683: value=1680.000000
2025-08-05 14:16:02,678 - [__main__] Rank 1 - ERROR -   Index 1999: value=1416.000000
2025-08-05 14:16:02,678 - [__main__] Rank 1 - ERROR -   Index 307: value=316.000000
2025-08-05 14:16:02,678 - [__main__] Rank 1 - ERROR -   Index 1371: value=-282.000000
2025-08-05 14:16:02,680 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.804688, var=5696.000000, max_abs=1632.000000 [CRITICAL][0m
2025-08-05 14:16:02,680 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1632.000000[0m
2025-08-05 14:16:02,680 - [__main__] Rank 1 - ERROR - First 10 values: [65.0, 57.0, -31.0, 29.75, -45.0, -19.75, -27.0, 46.25, 1.8125, 2.25]
2025-08-05 14:16:02,680 - [__main__] Rank 1 - ERROR -   Index 1793: value=1632.000000
2025-08-05 14:16:02,681 - [__main__] Rank 1 - ERROR -   Index 1683: value=1232.000000
2025-08-05 14:16:02,681 - [__main__] Rank 1 - ERROR -   Index 1999: value=1080.000000
2025-08-05 14:16:02,681 - [__main__] Rank 1 - ERROR -   Index 47: value=288.000000
2025-08-05 14:16:02,682 - [__main__] Rank 1 - ERROR -   Index 425: value=-280.000000
2025-08-05 14:16:02,682 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=832.000, offset=17, step=256
2025-08-05 14:16:02,682 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=17 L15:off=17 L16:off=17 L17:off=17 L18:off=17 L19:off=17 L20:off=17 L21:off=17 L22:off=17 L23:off=17 L24:off=17 L25:off=17 L26:off=17 L27:off=17
2025-08-05 14:16:02,682 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=434f84c333f31832, norm=3408.000, first_4=[65.0, 57.0, -31.0, 29.75], checksum=-1648.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:02,686 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 65.000000, values=[65.0, 57.0, -31.0, 29.75]...
2025-08-05 14:16:02,686 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=e6e3f1d2deb9cf8f, data size=3322 bytes
2025-08-05 14:16:02,686 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:02,698 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:02,698 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:02,700 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 434f84c333f31832, size=3322
2025-08-05 14:16:03,053 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:03,054 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3319 bytes
2025-08-05 14:16:03,054 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3319
2025-08-05 14:16:03,054 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 83ce9b9bd85a677a, size=3319
2025-08-05 14:16:03,054 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=83ce9b9bd85a677a, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:03,059 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 8.937500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 8.937500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,066 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 8.937500, values=[2.53125, 8.9375, -2.1875, -2.875]...
2025-08-05 14:16:03,066 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=83ce9b9bd85a677a, norm=139.000, first_4=[2.53125, 8.9375, -2.1875, -2.875], checksum=45.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:03,074 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,078 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,082 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,086 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,090 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,093 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,097 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,101 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,104 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,107 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,112 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,115 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,118 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,121 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,125 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,130 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,134 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,138 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,142 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,145 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,149 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,155 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,159 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,164 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,167 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,171 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,175 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,180 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=17 L15:off=17 L16:off=17 L17:off=17 L18:off=17 L19:off=17 L20:off=17 L21:off=17 L22:off=17 L23:off=17 L24:off=17 L25:off=17 L26:off=17 L27:off=17
2025-08-05 14:16:03,181 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:03,182 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.022217, var=9.375000, max_abs=42.250000 [CRITICAL][0m
2025-08-05 14:16:03,182 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=42.250000[0m
2025-08-05 14:16:03,182 - [__main__] Rank 1 - ERROR - First 10 values: [2.53125, 8.9375, -2.1875, -2.875, -0.9453125, 0.34375, -2.53125, -1.4765625, 4.875, -0.6875]
2025-08-05 14:16:03,182 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.250000
2025-08-05 14:16:03,182 - [__main__] Rank 1 - ERROR -   Index 1793: value=-33.250000
2025-08-05 14:16:03,183 - [__main__] Rank 1 - ERROR -   Index 1999: value=31.375000
2025-08-05 14:16:03,183 - [__main__] Rank 1 - ERROR -   Index 641: value=24.500000
2025-08-05 14:16:03,183 - [__main__] Rank 1 - ERROR -   Index 940: value=20.750000
2025-08-05 14:16:03,185 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.079590, var=13.125000, max_abs=53.500000 [CRITICAL][0m
2025-08-05 14:16:03,185 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.500000[0m
2025-08-05 14:16:03,185 - [__main__] Rank 1 - ERROR - First 10 values: [-0.0078125, 12.0625, -3.5, -1.015625, -2.515625, 0.28125, 0.2109375, -3.390625, 7.0625, 0.083984375]
2025-08-05 14:16:03,185 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.500000
2025-08-05 14:16:03,186 - [__main__] Rank 1 - ERROR -   Index 1999: value=43.250000
2025-08-05 14:16:03,186 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.250000
2025-08-05 14:16:03,186 - [__main__] Rank 1 - ERROR -   Index 940: value=26.875000
2025-08-05 14:16:03,186 - [__main__] Rank 1 - ERROR -   Index 641: value=26.125000
2025-08-05 14:16:03,186 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1536.000, offset=18, step=256
2025-08-05 14:16:03,187 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-386.000, offset=18, step=256
2025-08-05 14:16:03,188 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=474.000, offset=18, step=256
2025-08-05 14:16:03,189 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3216.000, offset=18, step=256
2025-08-05 14:16:03,190 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=298.000, offset=18, step=256
2025-08-05 14:16:03,191 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2096.000, offset=18, step=256
2025-08-05 14:16:03,192 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1888.000, offset=18, step=256
2025-08-05 14:16:03,193 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=125.000, offset=18, step=256
2025-08-05 14:16:03,194 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-360.000, offset=18, step=256
2025-08-05 14:16:03,196 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=448.000, offset=18, step=256
2025-08-05 14:16:03,197 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1968.000, offset=18, step=256
2025-08-05 14:16:03,198 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1568.000, offset=18, step=256
2025-08-05 14:16:03,199 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2352.000, offset=18, step=256
2025-08-05 14:16:03,200 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.898438, var=7168.000000, max_abs=1984.000000 [CRITICAL][0m
2025-08-05 14:16:03,200 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1984.000000[0m
2025-08-05 14:16:03,200 - [__main__] Rank 1 - ERROR - First 10 values: [62.0, 66.0, -67.0, -21.875, 0.4375, -59.5, -35.0, 20.0, -4.4375, 11.5625]
2025-08-05 14:16:03,201 - [__main__] Rank 1 - ERROR -   Index 1793: value=1984.000000
2025-08-05 14:16:03,201 - [__main__] Rank 1 - ERROR -   Index 1683: value=1760.000000
2025-08-05 14:16:03,202 - [__main__] Rank 1 - ERROR -   Index 1999: value=1648.000000
2025-08-05 14:16:03,202 - [__main__] Rank 1 - ERROR -   Index 1960: value=-376.000000
2025-08-05 14:16:03,202 - [__main__] Rank 1 - ERROR -   Index 307: value=316.000000
2025-08-05 14:16:03,204 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.145508, var=5056.000000, max_abs=1424.000000 [CRITICAL][0m
2025-08-05 14:16:03,204 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1424.000000[0m
2025-08-05 14:16:03,204 - [__main__] Rank 1 - ERROR - First 10 values: [62.5, 35.0, -42.0, 1.5, -7.8125, -55.0, -21.875, 58.75, -30.0, 26.625]
2025-08-05 14:16:03,204 - [__main__] Rank 1 - ERROR -   Index 1793: value=1424.000000
2025-08-05 14:16:03,205 - [__main__] Rank 1 - ERROR -   Index 1683: value=1008.000000
2025-08-05 14:16:03,205 - [__main__] Rank 1 - ERROR -   Index 1999: value=972.000000
2025-08-05 14:16:03,205 - [__main__] Rank 1 - ERROR -   Index 1960: value=-414.000000
2025-08-05 14:16:03,205 - [__main__] Rank 1 - ERROR -   Index 47: value=362.000000
2025-08-05 14:16:03,206 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=900.000, offset=18, step=256
2025-08-05 14:16:03,206 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=18 L15:off=18 L16:off=18 L17:off=18 L18:off=18 L19:off=18 L20:off=18 L21:off=18 L22:off=18 L23:off=18 L24:off=18 L25:off=18 L26:off=18 L27:off=18
2025-08-05 14:16:03,207 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=76ac495aea92c361, norm=3216.000, first_4=[62.5, 35.0, -42.0, 1.5], checksum=298.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:03,209 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 62.500000, values=[62.5, 35.0, -42.0, 1.5]...
2025-08-05 14:16:03,209 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=6eaf656dadb6242b, data size=3310 bytes
2025-08-05 14:16:03,209 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:03,224 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:03,224 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:03,226 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 76ac495aea92c361, size=3310
2025-08-05 14:16:03,588 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:03,588 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3317 bytes
2025-08-05 14:16:03,588 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3317
2025-08-05 14:16:03,588 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: e7fee370104ae158, size=3317
2025-08-05 14:16:03,588 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=e7fee370104ae158, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:03,595 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 10.375000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 10.375000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,600 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 10.375000, values=[1.796875, 10.375, -3.5625, -2.25]...
2025-08-05 14:16:03,600 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=e7fee370104ae158, norm=140.000, first_4=[1.796875, 10.375, -3.5625, -2.25], checksum=70.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:03,609 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,613 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,618 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,623 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,627 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,631 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,635 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,639 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,642 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,646 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,651 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,655 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,659 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,663 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,666 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,669 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,673 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,676 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,680 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,684 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,688 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,691 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,697 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,701 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,705 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,710 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,714 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,717 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=18 L15:off=18 L16:off=18 L17:off=18 L18:off=18 L19:off=18 L20:off=18 L21:off=18 L22:off=18 L23:off=18 L24:off=18 L25:off=18 L26:off=18 L27:off=18
2025-08-05 14:16:03,718 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:03,719 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.034424, var=9.625000, max_abs=43.000000 [CRITICAL][0m
2025-08-05 14:16:03,719 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=43.000000[0m
2025-08-05 14:16:03,719 - [__main__] Rank 1 - ERROR - First 10 values: [1.796875, 10.375, -3.5625, -2.25, -1.0625, -0.0185546875, -1.9140625, -1.296875, 3.671875, -5.125]
2025-08-05 14:16:03,719 - [__main__] Rank 1 - ERROR -   Index 1371: value=-43.000000
2025-08-05 14:16:03,720 - [__main__] Rank 1 - ERROR -   Index 1793: value=-31.125000
2025-08-05 14:16:03,720 - [__main__] Rank 1 - ERROR -   Index 1999: value=29.125000
2025-08-05 14:16:03,721 - [__main__] Rank 1 - ERROR -   Index 641: value=24.125000
2025-08-05 14:16:03,721 - [__main__] Rank 1 - ERROR -   Index 940: value=19.625000
2025-08-05 14:16:03,723 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.081543, var=12.875000, max_abs=54.750000 [CRITICAL][0m
2025-08-05 14:16:03,723 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=54.750000[0m
2025-08-05 14:16:03,723 - [__main__] Rank 1 - ERROR - First 10 values: [-0.484375, 14.1875, -3.484375, -0.64453125, -2.328125, -1.0625, 0.9375, -2.796875, 6.09375, -5.125]
2025-08-05 14:16:03,723 - [__main__] Rank 1 - ERROR -   Index 1371: value=-54.750000
2025-08-05 14:16:03,723 - [__main__] Rank 1 - ERROR -   Index 1999: value=40.000000
2025-08-05 14:16:03,723 - [__main__] Rank 1 - ERROR -   Index 1793: value=-31.500000
2025-08-05 14:16:03,724 - [__main__] Rank 1 - ERROR -   Index 940: value=26.125000
2025-08-05 14:16:03,724 - [__main__] Rank 1 - ERROR -   Index 641: value=26.000000
2025-08-05 14:16:03,725 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1632.000, offset=19, step=256
2025-08-05 14:16:03,725 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-456.000, offset=19, step=256
2025-08-05 14:16:03,726 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=480.000, offset=19, step=256
2025-08-05 14:16:03,728 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3408.000, offset=19, step=256
2025-08-05 14:16:03,729 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=302.000, offset=19, step=256
2025-08-05 14:16:03,731 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2192.000, offset=19, step=256
2025-08-05 14:16:03,732 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2000.000, offset=19, step=256
2025-08-05 14:16:03,733 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=167.000, offset=19, step=256
2025-08-05 14:16:03,734 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-356.000, offset=19, step=256
2025-08-05 14:16:03,735 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=520.000, offset=19, step=256
2025-08-05 14:16:03,736 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2064.000, offset=19, step=256
2025-08-05 14:16:03,738 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1640.000, offset=19, step=256
2025-08-05 14:16:03,739 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2528.000, offset=19, step=256
2025-08-05 14:16:03,740 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.304688, var=7168.000000, max_abs=1968.000000 [CRITICAL][0m
2025-08-05 14:16:03,740 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1968.000000[0m
2025-08-05 14:16:03,740 - [__main__] Rank 1 - ERROR - First 10 values: [56.5, 52.5, -58.5, -13.1875, -9.0, -57.75, -10.125, -2.75, -13.0, 12.625]
2025-08-05 14:16:03,741 - [__main__] Rank 1 - ERROR -   Index 1793: value=1968.000000
2025-08-05 14:16:03,742 - [__main__] Rank 1 - ERROR -   Index 1683: value=1776.000000
2025-08-05 14:16:03,742 - [__main__] Rank 1 - ERROR -   Index 1999: value=1624.000000
2025-08-05 14:16:03,742 - [__main__] Rank 1 - ERROR -   Index 1960: value=-356.000000
2025-08-05 14:16:03,742 - [__main__] Rank 1 - ERROR -   Index 307: value=332.000000
2025-08-05 14:16:03,744 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.285156, var=4864.000000, max_abs=1312.000000 [CRITICAL][0m
2025-08-05 14:16:03,744 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1312.000000[0m
2025-08-05 14:16:03,744 - [__main__] Rank 1 - ERROR - First 10 values: [62.25, 32.5, -31.25, 23.125, -25.75, -52.0, -1.0, 34.5, -32.0, 17.25]
2025-08-05 14:16:03,744 - [__main__] Rank 1 - ERROR -   Index 1793: value=1312.000000
2025-08-05 14:16:03,744 - [__main__] Rank 1 - ERROR -   Index 1683: value=964.000000
2025-08-05 14:16:03,744 - [__main__] Rank 1 - ERROR -   Index 1999: value=880.000000
2025-08-05 14:16:03,745 - [__main__] Rank 1 - ERROR -   Index 1960: value=-418.000000
2025-08-05 14:16:03,745 - [__main__] Rank 1 - ERROR -   Index 47: value=354.000000
2025-08-05 14:16:03,746 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=976.000, offset=19, step=256
2025-08-05 14:16:03,746 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=19 L15:off=19 L16:off=19 L17:off=19 L18:off=19 L19:off=19 L20:off=19 L21:off=19 L22:off=19 L23:off=19 L24:off=19 L25:off=19 L26:off=19 L27:off=19
2025-08-05 14:16:03,746 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=ca4af46671867e1c, norm=3152.000, first_4=[62.25, 32.5, -31.25, 23.125], checksum=-584.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:03,749 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 70.000000, values=[62.25, 32.5, -31.25, 23.125]...
2025-08-05 14:16:03,749 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=d27f3d309d56d552, data size=3307 bytes
2025-08-05 14:16:03,749 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:03,761 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:03,762 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:03,763 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: ca4af46671867e1c, size=3307
2025-08-05 14:16:04,133 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:04,133 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3335 bytes
2025-08-05 14:16:04,133 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3335
2025-08-05 14:16:04,133 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: fadd11243f55e182, size=3335
2025-08-05 14:16:04,133 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=fadd11243f55e182, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:04,137 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 8.812500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 8.812500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,140 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 8.812500, values=[1.984375, 8.8125, -3.609375, -2.390625]...
2025-08-05 14:16:04,141 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=fadd11243f55e182, norm=146.000, first_4=[1.984375, 8.8125, -3.609375, -2.390625], checksum=101.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:04,151 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,156 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,159 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,164 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,169 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,173 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,177 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,181 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,184 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,188 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,192 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,196 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,201 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,206 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,211 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,215 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,220 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,223 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,226 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,231 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,235 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,239 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,242 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,246 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,252 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,256 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,260 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,265 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,266 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:04,266 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:04,267 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:04,267 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:04,267 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=19 L15:off=19 L16:off=19 L17:off=19 L18:off=19 L19:off=19 L20:off=19 L21:off=19 L22:off=19 L23:off=19 L24:off=19 L25:off=19 L26:off=19 L27:off=19
2025-08-05 14:16:04,267 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:04,268 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.049561, var=10.437500, max_abs=45.250000 [CRITICAL][0m
2025-08-05 14:16:04,268 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=45.250000[0m
2025-08-05 14:16:04,268 - [__main__] Rank 1 - ERROR - First 10 values: [1.984375, 8.8125, -3.609375, -2.390625, -2.6875, -0.703125, -0.5234375, -1.125, 2.34375, 3.203125]
2025-08-05 14:16:04,269 - [__main__] Rank 1 - ERROR -   Index 1999: value=45.250000
2025-08-05 14:16:04,269 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.000000
2025-08-05 14:16:04,270 - [__main__] Rank 1 - ERROR -   Index 1793: value=-36.000000
2025-08-05 14:16:04,270 - [__main__] Rank 1 - ERROR -   Index 641: value=28.250000
2025-08-05 14:16:04,271 - [__main__] Rank 1 - ERROR -   Index 47: value=-17.625000
2025-08-05 14:16:04,272 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.094727, var=13.625000, max_abs=53.750000 [CRITICAL][0m
2025-08-05 14:16:04,272 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.750000[0m
2025-08-05 14:16:04,273 - [__main__] Rank 1 - ERROR - First 10 values: [0.7265625, 14.875, -3.21875, -1.125, -3.6875, -1.8203125, 0.84375, -3.171875, 4.28125, 3.671875]
2025-08-05 14:16:04,273 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.750000
2025-08-05 14:16:04,273 - [__main__] Rank 1 - ERROR -   Index 1999: value=47.250000
2025-08-05 14:16:04,274 - [__main__] Rank 1 - ERROR -   Index 1793: value=-36.000000
2025-08-05 14:16:04,274 - [__main__] Rank 1 - ERROR -   Index 641: value=28.625000
2025-08-05 14:16:04,274 - [__main__] Rank 1 - ERROR -   Index 940: value=21.250000
2025-08-05 14:16:04,274 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1752.000, offset=20, step=256
2025-08-05 14:16:04,274 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-584.000, offset=20, step=256
2025-08-05 14:16:04,275 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=492.000, offset=20, step=256
2025-08-05 14:16:04,276 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3568.000, offset=20, step=256
2025-08-05 14:16:04,277 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=276.000, offset=20, step=256
2025-08-05 14:16:04,278 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2288.000, offset=20, step=256
2025-08-05 14:16:04,279 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2112.000, offset=20, step=256
2025-08-05 14:16:04,281 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=200.000, offset=20, step=256
2025-08-05 14:16:04,282 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-366.000, offset=20, step=256
2025-08-05 14:16:04,283 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=600.000, offset=20, step=256
2025-08-05 14:16:04,284 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2128.000, offset=20, step=256
2025-08-05 14:16:04,285 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1752.000, offset=20, step=256
2025-08-05 14:16:04,286 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2688.000, offset=20, step=256
2025-08-05 14:16:04,288 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.273438, var=8320.000000, max_abs=2192.000000 [CRITICAL][0m
2025-08-05 14:16:04,288 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2192.000000[0m
2025-08-05 14:16:04,288 - [__main__] Rank 1 - ERROR - First 10 values: [17.375, 14.6875, -94.0, 21.75, -8.25, -53.5, -14.5, 18.75, 8.5625, 21.75]
2025-08-05 14:16:04,288 - [__main__] Rank 1 - ERROR -   Index 1793: value=2192.000000
2025-08-05 14:16:04,289 - [__main__] Rank 1 - ERROR -   Index 1683: value=1920.000000
2025-08-05 14:16:04,289 - [__main__] Rank 1 - ERROR -   Index 1999: value=1856.000000
2025-08-05 14:16:04,289 - [__main__] Rank 1 - ERROR -   Index 307: value=326.000000
2025-08-05 14:16:04,289 - [__main__] Rank 1 - ERROR -   Index 1960: value=-322.000000
2025-08-05 14:16:04,291 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.427734, var=5536.000000, max_abs=1480.000000 [CRITICAL][0m
2025-08-05 14:16:04,291 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1480.000000[0m
2025-08-05 14:16:04,291 - [__main__] Rank 1 - ERROR - First 10 values: [14.75, -12.875, -71.0, 49.5, -10.0625, -51.75, 2.375, 58.25, -8.5, 42.5]
2025-08-05 14:16:04,291 - [__main__] Rank 1 - ERROR -   Index 1793: value=1480.000000
2025-08-05 14:16:04,292 - [__main__] Rank 1 - ERROR -   Index 1683: value=1088.000000
2025-08-05 14:16:04,292 - [__main__] Rank 1 - ERROR -   Index 1999: value=1056.000000
2025-08-05 14:16:04,292 - [__main__] Rank 1 - ERROR -   Index 1960: value=-432.000000
2025-08-05 14:16:04,292 - [__main__] Rank 1 - ERROR -   Index 49: value=-382.000000
2025-08-05 14:16:04,292 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1000.000, offset=20, step=256
2025-08-05 14:16:04,292 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=20 L15:off=20 L16:off=20 L17:off=20 L18:off=20 L19:off=20 L20:off=20 L21:off=20 L22:off=20 L23:off=20 L24:off=20 L25:off=20 L26:off=20 L27:off=20
2025-08-05 14:16:04,293 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=ffc020e3e07a03fc, norm=3360.000, first_4=[14.75, -12.875, -71.0, 49.5], checksum=-876.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:04,296 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 71.000000, values=[14.75, -12.875, -71.0, 49.5]...
2025-08-05 14:16:04,296 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=e1c16e6590e855a3, data size=3320 bytes
2025-08-05 14:16:04,297 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:04,308 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:04,308 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:04,309 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: ffc020e3e07a03fc, size=3320
2025-08-05 14:16:04,693 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:04,693 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3331 bytes
2025-08-05 14:16:04,693 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3331
2025-08-05 14:16:04,693 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 80c97e5e299783ab, size=3331
2025-08-05 14:16:04,693 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=80c97e5e299783ab, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:04,697 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 8.937500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 8.937500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,702 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 8.937500, values=[1.21875, 7.8125, -1.75, -3.84375]...
2025-08-05 14:16:04,703 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=80c97e5e299783ab, norm=155.000, first_4=[1.21875, 7.8125, -1.75, -3.84375], checksum=185.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:04,711 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,716 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,719 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,725 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,728 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,732 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,736 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,739 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,743 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,748 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,752 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,757 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,760 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,764 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,769 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,772 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,776 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,780 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,785 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,789 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,794 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,798 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,802 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,805 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,808 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,811 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,815 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,820 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=20 L15:off=20 L16:off=20 L17:off=20 L18:off=20 L19:off=20 L20:off=20 L21:off=20 L22:off=20 L23:off=20 L24:off=20 L25:off=20 L26:off=20 L27:off=20
2025-08-05 14:16:04,821 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:04,822 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.090332, var=11.750000, max_abs=42.750000 [CRITICAL][0m
2025-08-05 14:16:04,822 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=42.750000[0m
2025-08-05 14:16:04,822 - [__main__] Rank 1 - ERROR - First 10 values: [1.21875, 7.8125, -1.75, -3.84375, -2.90625, 0.76953125, -1.1484375, -0.3359375, -0.1328125, 8.9375]
2025-08-05 14:16:04,823 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.750000
2025-08-05 14:16:04,823 - [__main__] Rank 1 - ERROR -   Index 1793: value=-32.750000
2025-08-05 14:16:04,823 - [__main__] Rank 1 - ERROR -   Index 641: value=32.250000
2025-08-05 14:16:04,824 - [__main__] Rank 1 - ERROR -   Index 1999: value=32.000000
2025-08-05 14:16:04,824 - [__main__] Rank 1 - ERROR -   Index 1945: value=-19.375000
2025-08-05 14:16:04,825 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.146484, var=15.875000, max_abs=54.750000 [CRITICAL][0m
2025-08-05 14:16:04,825 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=54.750000[0m
2025-08-05 14:16:04,825 - [__main__] Rank 1 - ERROR - First 10 values: [0.796875, 12.5, -1.234375, -1.796875, -5.5625, 1.015625, 1.265625, -3.421875, 0.8125, 9.25]
2025-08-05 14:16:04,826 - [__main__] Rank 1 - ERROR -   Index 1371: value=-54.750000
2025-08-05 14:16:04,826 - [__main__] Rank 1 - ERROR -   Index 1999: value=48.000000
2025-08-05 14:16:04,826 - [__main__] Rank 1 - ERROR -   Index 1793: value=-36.250000
2025-08-05 14:16:04,826 - [__main__] Rank 1 - ERROR -   Index 641: value=32.500000
2025-08-05 14:16:04,827 - [__main__] Rank 1 - ERROR -   Index 940: value=24.500000
2025-08-05 14:16:04,827 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1848.000, offset=21, step=256
2025-08-05 14:16:04,827 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-732.000, offset=21, step=256
2025-08-05 14:16:04,828 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=510.000, offset=21, step=256
2025-08-05 14:16:04,830 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3776.000, offset=21, step=256
2025-08-05 14:16:04,831 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=308.000, offset=21, step=256
2025-08-05 14:16:04,832 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2320.000, offset=21, step=256
2025-08-05 14:16:04,834 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2176.000, offset=21, step=256
2025-08-05 14:16:04,835 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=140.000, offset=21, step=256
2025-08-05 14:16:04,836 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-364.000, offset=21, step=256
2025-08-05 14:16:04,837 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=744.000, offset=21, step=256
2025-08-05 14:16:04,839 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2112.000, offset=21, step=256
2025-08-05 14:16:04,840 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1848.000, offset=21, step=256
2025-08-05 14:16:04,840 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2816.000, offset=21, step=256
2025-08-05 14:16:04,842 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.667969, var=6656.000000, max_abs=1872.000000 [CRITICAL][0m
2025-08-05 14:16:04,842 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1872.000000[0m
2025-08-05 14:16:04,842 - [__main__] Rank 1 - ERROR - First 10 values: [65.5, 98.5, -44.5, -30.875, -70.5, -45.5, -17.125, -8.875, 20.5, 35.0]
2025-08-05 14:16:04,842 - [__main__] Rank 1 - ERROR -   Index 1793: value=1872.000000
2025-08-05 14:16:04,842 - [__main__] Rank 1 - ERROR -   Index 1683: value=1664.000000
2025-08-05 14:16:04,843 - [__main__] Rank 1 - ERROR -   Index 1999: value=1424.000000
2025-08-05 14:16:04,843 - [__main__] Rank 1 - ERROR -   Index 307: value=346.000000
2025-08-05 14:16:04,843 - [__main__] Rank 1 - ERROR -   Index 1371: value=-274.000000
2025-08-05 14:16:04,845 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.198242, var=6688.000000, max_abs=1816.000000 [CRITICAL][0m
2025-08-05 14:16:04,845 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1816.000000[0m
2025-08-05 14:16:04,845 - [__main__] Rank 1 - ERROR - First 10 values: [83.5, 79.5, -22.5, 8.6875, -92.5, -45.25, -3.5, 16.5, 13.0, 36.75]
2025-08-05 14:16:04,846 - [__main__] Rank 1 - ERROR -   Index 1793: value=1816.000000
2025-08-05 14:16:04,846 - [__main__] Rank 1 - ERROR -   Index 1683: value=1368.000000
2025-08-05 14:16:04,846 - [__main__] Rank 1 - ERROR -   Index 1999: value=1280.000000
2025-08-05 14:16:04,846 - [__main__] Rank 1 - ERROR -   Index 425: value=-316.000000
2025-08-05 14:16:04,846 - [__main__] Rank 1 - ERROR -   Index 307: value=302.000000
2025-08-05 14:16:04,847 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1056.000, offset=21, step=256
2025-08-05 14:16:04,847 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=21 L15:off=21 L16:off=21 L17:off=21 L18:off=21 L19:off=21 L20:off=21 L21:off=21 L22:off=21 L23:off=21 L24:off=21 L25:off=21 L26:off=21 L27:off=21
2025-08-05 14:16:04,847 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=8176eff5f0137abb, norm=3696.000, first_4=[83.5, 79.5, -22.5, 8.6875], checksum=406.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:04,850 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 92.500000, values=[83.5, 79.5, -22.5, 8.6875]...
2025-08-05 14:16:04,850 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=9ac2cadcdc4fcd01, data size=3318 bytes
2025-08-05 14:16:04,850 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:04,861 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:04,861 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:04,863 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 8176eff5f0137abb, size=3318
2025-08-05 14:16:05,230 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:05,231 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3326 bytes
2025-08-05 14:16:05,231 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3326
2025-08-05 14:16:05,231 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: bc1afa3a34a69b6e, size=3326
2025-08-05 14:16:05,231 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=bc1afa3a34a69b6e, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:05,236 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.343750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.343750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,243 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 7.343750, values=[1.171875, 7.34375, -3.40625, -1.8125]...
2025-08-05 14:16:05,243 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=bc1afa3a34a69b6e, norm=137.000, first_4=[1.171875, 7.34375, -3.40625, -1.8125], checksum=140.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:05,250 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,254 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,261 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,266 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,271 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,274 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,278 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,282 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,286 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,290 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,294 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,301 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,308 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,311 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,314 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,316 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,320 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,325 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,331 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,335 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,339 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,343 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,346 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,350 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,354 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,357 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,361 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,365 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=21 L15:off=21 L16:off=21 L17:off=21 L18:off=21 L19:off=21 L20:off=21 L21:off=21 L22:off=21 L23:off=21 L24:off=21 L25:off=21 L26:off=21 L27:off=21
2025-08-05 14:16:05,366 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:05,367 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.068359, var=9.187500, max_abs=41.500000 [CRITICAL][0m
2025-08-05 14:16:05,367 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=41.500000[0m
2025-08-05 14:16:05,367 - [__main__] Rank 1 - ERROR - First 10 values: [1.171875, 7.34375, -3.40625, -1.8125, -2.046875, 2.015625, -1.5234375, -1.875, 3.4375, 2.109375]
2025-08-05 14:16:05,367 - [__main__] Rank 1 - ERROR -   Index 1371: value=-41.500000
2025-08-05 14:16:05,367 - [__main__] Rank 1 - ERROR -   Index 1793: value=-32.750000
2025-08-05 14:16:05,367 - [__main__] Rank 1 - ERROR -   Index 1999: value=32.500000
2025-08-05 14:16:05,368 - [__main__] Rank 1 - ERROR -   Index 641: value=26.375000
2025-08-05 14:16:05,368 - [__main__] Rank 1 - ERROR -   Index 1945: value=-17.125000
2025-08-05 14:16:05,369 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.128906, var=13.312500, max_abs=53.500000 [CRITICAL][0m
2025-08-05 14:16:05,369 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.500000[0m
2025-08-05 14:16:05,369 - [__main__] Rank 1 - ERROR - First 10 values: [2.25, 11.875, -3.984375, -0.03125, -3.71875, 2.359375, 1.078125, -3.203125, 6.4375, 2.71875]
2025-08-05 14:16:05,370 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.500000
2025-08-05 14:16:05,370 - [__main__] Rank 1 - ERROR -   Index 1999: value=44.000000
2025-08-05 14:16:05,371 - [__main__] Rank 1 - ERROR -   Index 1793: value=-33.000000
2025-08-05 14:16:05,371 - [__main__] Rank 1 - ERROR -   Index 641: value=25.875000
2025-08-05 14:16:05,371 - [__main__] Rank 1 - ERROR -   Index 940: value=21.750000
2025-08-05 14:16:05,371 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1944.000, offset=22, step=256
2025-08-05 14:16:05,372 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-808.000, offset=22, step=256
2025-08-05 14:16:05,373 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=568.000, offset=22, step=256
2025-08-05 14:16:05,374 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3952.000, offset=22, step=256
2025-08-05 14:16:05,376 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=342.000, offset=22, step=256
2025-08-05 14:16:05,377 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2336.000, offset=22, step=256
2025-08-05 14:16:05,378 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2320.000, offset=22, step=256
2025-08-05 14:16:05,380 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=119.000, offset=22, step=256
2025-08-05 14:16:05,381 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-354.000, offset=22, step=256
2025-08-05 14:16:05,382 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=908.000, offset=22, step=256
2025-08-05 14:16:05,384 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2144.000, offset=22, step=256
2025-08-05 14:16:05,385 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1928.000, offset=22, step=256
2025-08-05 14:16:05,386 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2880.000, offset=22, step=256
2025-08-05 14:16:05,387 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.859375, var=7072.000000, max_abs=1952.000000 [CRITICAL][0m
2025-08-05 14:16:05,387 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1952.000000[0m
2025-08-05 14:16:05,387 - [__main__] Rank 1 - ERROR - First 10 values: [52.25, 73.0, -16.0, -41.25, -8.875, -71.5, -29.875, 13.25, -15.4375, 25.75]
2025-08-05 14:16:05,388 - [__main__] Rank 1 - ERROR -   Index 1793: value=1952.000000
2025-08-05 14:16:05,388 - [__main__] Rank 1 - ERROR -   Index 1683: value=1736.000000
2025-08-05 14:16:05,388 - [__main__] Rank 1 - ERROR -   Index 1999: value=1616.000000
2025-08-05 14:16:05,388 - [__main__] Rank 1 - ERROR -   Index 1960: value=-394.000000
2025-08-05 14:16:05,388 - [__main__] Rank 1 - ERROR -   Index 307: value=350.000000
2025-08-05 14:16:05,390 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.546875, var=5632.000000, max_abs=1544.000000 [CRITICAL][0m
2025-08-05 14:16:05,390 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1544.000000[0m
2025-08-05 14:16:05,390 - [__main__] Rank 1 - ERROR - First 10 values: [60.0, 43.0, 10.9375, -18.75, -27.25, -73.0, -15.75, 58.0, -41.0, 49.5]
2025-08-05 14:16:05,390 - [__main__] Rank 1 - ERROR -   Index 1793: value=1544.000000
2025-08-05 14:16:05,391 - [__main__] Rank 1 - ERROR -   Index 1683: value=1120.000000
2025-08-05 14:16:05,391 - [__main__] Rank 1 - ERROR -   Index 1999: value=1096.000000
2025-08-05 14:16:05,391 - [__main__] Rank 1 - ERROR -   Index 1960: value=-444.000000
2025-08-05 14:16:05,392 - [__main__] Rank 1 - ERROR -   Index 47: value=358.000000
2025-08-05 14:16:05,392 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1128.000, offset=22, step=256
2025-08-05 14:16:05,392 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=22 L15:off=22 L16:off=22 L17:off=22 L18:off=22 L19:off=22 L20:off=22 L21:off=22 L22:off=22 L23:off=22 L24:off=22 L25:off=22 L26:off=22 L27:off=22
2025-08-05 14:16:05,393 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=3db937f321689fa5, norm=3392.000, first_4=[60.0, 43.0, 10.9375, -18.75], checksum=1120.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:05,396 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 87.500000, values=[60.0, 43.0, 10.9375, -18.75]...
2025-08-05 14:16:05,396 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=3362519bd039ca8a, data size=3310 bytes
2025-08-05 14:16:05,396 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:05,410 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:05,410 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:05,412 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 3db937f321689fa5, size=3310
2025-08-05 14:16:05,788 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:05,788 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3336 bytes
2025-08-05 14:16:05,788 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3336
2025-08-05 14:16:05,788 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 563c9610381e2e38, size=3336
2025-08-05 14:16:05,788 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=563c9610381e2e38, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:05,794 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 8.812500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 8.812500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,801 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 8.812500, values=[1.2265625, 8.8125, -5.40625, -0.03369140625]...
2025-08-05 14:16:05,802 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=563c9610381e2e38, norm=138.000, first_4=[1.2265625, 8.8125, -5.40625, -0.03369140625], checksum=132.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:05,810 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,815 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,821 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,825 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,829 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,833 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,837 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,842 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,846 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,850 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,854 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,857 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,861 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,866 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,869 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,873 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,876 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,880 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,885 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,889 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,893 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,899 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,902 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,906 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,911 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,916 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,920 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,925 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=22 L15:off=22 L16:off=22 L17:off=22 L18:off=22 L19:off=22 L20:off=22 L21:off=22 L22:off=22 L23:off=22 L24:off=22 L25:off=22 L26:off=22 L27:off=22
2025-08-05 14:16:05,927 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:05,928 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.064453, var=9.250000, max_abs=42.000000 [CRITICAL][0m
2025-08-05 14:16:05,928 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=42.000000[0m
2025-08-05 14:16:05,929 - [__main__] Rank 1 - ERROR - First 10 values: [1.2265625, 8.8125, -5.40625, -0.03369140625, -0.51171875, 1.3125, -1.0078125, -0.69921875, 2.4375, -3.328125]
2025-08-05 14:16:05,929 - [__main__] Rank 1 - ERROR -   Index 1371: value=-42.000000
2025-08-05 14:16:05,930 - [__main__] Rank 1 - ERROR -   Index 1999: value=35.000000
2025-08-05 14:16:05,930 - [__main__] Rank 1 - ERROR -   Index 1793: value=-29.500000
2025-08-05 14:16:05,930 - [__main__] Rank 1 - ERROR -   Index 641: value=23.500000
2025-08-05 14:16:05,931 - [__main__] Rank 1 - ERROR -   Index 319: value=-17.750000
2025-08-05 14:16:05,933 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.118164, var=12.937500, max_abs=54.750000 [CRITICAL][0m
2025-08-05 14:16:05,933 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=54.750000[0m
2025-08-05 14:16:05,933 - [__main__] Rank 1 - ERROR - First 10 values: [1.8515625, 14.0, -5.1875, 2.328125, -2.625, 0.90234375, 1.4609375, -2.515625, 5.34375, -3.34375]
2025-08-05 14:16:05,933 - [__main__] Rank 1 - ERROR -   Index 1371: value=-54.750000
2025-08-05 14:16:05,934 - [__main__] Rank 1 - ERROR -   Index 1999: value=46.750000
2025-08-05 14:16:05,934 - [__main__] Rank 1 - ERROR -   Index 1793: value=-30.250000
2025-08-05 14:16:05,934 - [__main__] Rank 1 - ERROR -   Index 641: value=23.125000
2025-08-05 14:16:05,935 - [__main__] Rank 1 - ERROR -   Index 940: value=21.875000
2025-08-05 14:16:05,935 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2032.000, offset=23, step=256
2025-08-05 14:16:05,935 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-872.000, offset=23, step=256
2025-08-05 14:16:05,937 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=612.000, offset=23, step=256
2025-08-05 14:16:05,939 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=4096.000, offset=23, step=256
2025-08-05 14:16:05,940 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=362.000, offset=23, step=256
2025-08-05 14:16:05,941 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2400.000, offset=23, step=256
2025-08-05 14:16:05,942 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2448.000, offset=23, step=256
2025-08-05 14:16:05,943 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=137.000, offset=23, step=256
2025-08-05 14:16:05,944 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-360.000, offset=23, step=256
2025-08-05 14:16:05,945 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1016.000, offset=23, step=256
2025-08-05 14:16:05,947 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2240.000, offset=23, step=256
2025-08-05 14:16:05,948 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1944.000, offset=23, step=256
2025-08-05 14:16:05,949 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3008.000, offset=23, step=256
2025-08-05 14:16:05,950 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.382812, var=6976.000000, max_abs=1928.000000 [CRITICAL][0m
2025-08-05 14:16:05,950 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1928.000000[0m
2025-08-05 14:16:05,950 - [__main__] Rank 1 - ERROR - First 10 values: [33.25, 52.0, -10.25, -37.0, -12.5625, -65.5, -13.125, -1.125, -17.625, 14.0]
2025-08-05 14:16:05,951 - [__main__] Rank 1 - ERROR -   Index 1793: value=1928.000000
2025-08-05 14:16:05,951 - [__main__] Rank 1 - ERROR -   Index 1683: value=1752.000000
2025-08-05 14:16:05,951 - [__main__] Rank 1 - ERROR -   Index 1999: value=1600.000000
2025-08-05 14:16:05,951 - [__main__] Rank 1 - ERROR -   Index 1960: value=-378.000000
2025-08-05 14:16:05,951 - [__main__] Rank 1 - ERROR -   Index 307: value=358.000000
2025-08-05 14:16:05,953 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.055420, var=4800.000000, max_abs=1280.000000 [CRITICAL][0m
2025-08-05 14:16:05,953 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1280.000000[0m
2025-08-05 14:16:05,953 - [__main__] Rank 1 - ERROR - First 10 values: [35.25, 20.375, 15.6875, 2.984375, -37.25, -77.5, -4.5, 33.5, -42.25, 18.25]
2025-08-05 14:16:05,954 - [__main__] Rank 1 - ERROR -   Index 1793: value=1280.000000
2025-08-05 14:16:05,954 - [__main__] Rank 1 - ERROR -   Index 1683: value=952.000000
2025-08-05 14:16:05,954 - [__main__] Rank 1 - ERROR -   Index 1999: value=868.000000
2025-08-05 14:16:05,954 - [__main__] Rank 1 - ERROR -   Index 1960: value=-410.000000
2025-08-05 14:16:05,954 - [__main__] Rank 1 - ERROR -   Index 47: value=344.000000
2025-08-05 14:16:05,955 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1200.000, offset=23, step=256
2025-08-05 14:16:05,955 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=23 L15:off=23 L16:off=23 L17:off=23 L18:off=23 L19:off=23 L20:off=23 L21:off=23 L22:off=23 L23:off=23 L24:off=23 L25:off=23 L26:off=23 L27:off=23
2025-08-05 14:16:05,956 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=5a61a78d62066efd, norm=3136.000, first_4=[35.25, 20.375, 15.6875, 2.984375], checksum=-113.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:05,959 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 94.500000, values=[35.25, 20.375, 15.6875, 2.984375]...
2025-08-05 14:16:05,959 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=0334183c53a1fe2a, data size=3306 bytes
2025-08-05 14:16:05,959 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:05,970 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:05,970 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:05,971 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 5a61a78d62066efd, size=3306
2025-08-05 14:16:06,354 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:06,354 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3324 bytes
2025-08-05 14:16:06,354 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3324
2025-08-05 14:16:06,354 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 59f0a4ca859da216, size=3324
2025-08-05 14:16:06,354 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=59f0a4ca859da216, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:06,360 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.968750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.968750, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,365 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 7.968750, values=[1.453125, 7.96875, -5.5625, 0.6171875]...
2025-08-05 14:16:06,366 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=59f0a4ca859da216, norm=143.000, first_4=[1.453125, 7.96875, -5.5625, 0.6171875], checksum=106.500000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:06,374 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,378 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,384 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,388 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,392 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,397 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,401 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,405 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,409 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,412 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,416 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,420 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,424 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,428 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,432 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,435 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,440 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,445 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,448 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,451 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,455 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,459 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,463 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,468 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,473 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,476 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,481 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,485 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=23 L15:off=23 L16:off=23 L17:off=23 L18:off=23 L19:off=23 L20:off=23 L21:off=23 L22:off=23 L23:off=23 L24:off=23 L25:off=23 L26:off=23 L27:off=23
2025-08-05 14:16:06,487 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:06,488 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.052002, var=10.000000, max_abs=51.250000 [CRITICAL][0m
2025-08-05 14:16:06,488 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=51.250000[0m
2025-08-05 14:16:06,488 - [__main__] Rank 1 - ERROR - First 10 values: [1.453125, 7.96875, -5.5625, 0.6171875, -0.734375, 0.5390625, -0.3125, -1.171875, 2.890625, 3.96875]
2025-08-05 14:16:06,489 - [__main__] Rank 1 - ERROR -   Index 1999: value=51.250000
2025-08-05 14:16:06,489 - [__main__] Rank 1 - ERROR -   Index 1371: value=-40.750000
2025-08-05 14:16:06,489 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.000000
2025-08-05 14:16:06,489 - [__main__] Rank 1 - ERROR -   Index 641: value=25.125000
2025-08-05 14:16:06,490 - [__main__] Rank 1 - ERROR -   Index 47: value=-17.000000
2025-08-05 14:16:06,491 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.103027, var=14.000000, max_abs=62.250000 [CRITICAL][0m
2025-08-05 14:16:06,491 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=62.250000[0m
2025-08-05 14:16:06,491 - [__main__] Rank 1 - ERROR - First 10 values: [1.65625, 13.8125, -4.3125, 1.71875, -2.5, 0.22265625, 0.380859375, -2.9375, 5.34375, 4.15625]
2025-08-05 14:16:06,492 - [__main__] Rank 1 - ERROR -   Index 1999: value=62.250000
2025-08-05 14:16:06,492 - [__main__] Rank 1 - ERROR -   Index 1371: value=-53.000000
2025-08-05 14:16:06,492 - [__main__] Rank 1 - ERROR -   Index 1793: value=-37.750000
2025-08-05 14:16:06,492 - [__main__] Rank 1 - ERROR -   Index 641: value=24.500000
2025-08-05 14:16:06,493 - [__main__] Rank 1 - ERROR -   Index 940: value=21.250000
2025-08-05 14:16:06,493 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2128.000, offset=24, step=256
2025-08-05 14:16:06,494 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-912.000, offset=24, step=256
2025-08-05 14:16:06,495 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=648.000, offset=24, step=256
2025-08-05 14:16:06,497 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=4288.000, offset=24, step=256
2025-08-05 14:16:06,498 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=340.000, offset=24, step=256
2025-08-05 14:16:06,499 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2464.000, offset=24, step=256
2025-08-05 14:16:06,500 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2592.000, offset=24, step=256
2025-08-05 14:16:06,501 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=136.000, offset=24, step=256
2025-08-05 14:16:06,502 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-368.000, offset=24, step=256
2025-08-05 14:16:06,504 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1096.000, offset=24, step=256
2025-08-05 14:16:06,505 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2352.000, offset=24, step=256
2025-08-05 14:16:06,506 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2064.000, offset=24, step=256
2025-08-05 14:16:06,508 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3152.000, offset=24, step=256
2025-08-05 14:16:06,509 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.933594, var=8704.000000, max_abs=2224.000000 [CRITICAL][0m
2025-08-05 14:16:06,509 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=2224.000000[0m
2025-08-05 14:16:06,509 - [__main__] Rank 1 - ERROR - First 10 values: [-22.0, 30.625, -49.5, 3.375, -20.875, -59.5, -31.875, 23.25, 29.125, 24.5]
2025-08-05 14:16:06,509 - [__main__] Rank 1 - ERROR -   Index 1793: value=2224.000000
2025-08-05 14:16:06,510 - [__main__] Rank 1 - ERROR -   Index 1683: value=1952.000000
2025-08-05 14:16:06,510 - [__main__] Rank 1 - ERROR -   Index 1999: value=1912.000000
2025-08-05 14:16:06,510 - [__main__] Rank 1 - ERROR -   Index 307: value=364.000000
2025-08-05 14:16:06,511 - [__main__] Rank 1 - ERROR -   Index 1960: value=-358.000000
2025-08-05 14:16:06,513 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=-0.351562, var=7392.000000, max_abs=1832.000000 [CRITICAL][0m
2025-08-05 14:16:06,513 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1832.000000[0m
2025-08-05 14:16:06,513 - [__main__] Rank 1 - ERROR - First 10 values: [-18.875, 3.75, -38.5, 35.75, -16.75, -56.0, -14.5, 62.0, 10.5, 45.5]
2025-08-05 14:16:06,513 - [__main__] Rank 1 - ERROR -   Index 1793: value=1832.000000
2025-08-05 14:16:06,514 - [__main__] Rank 1 - ERROR -   Index 1999: value=1440.000000
2025-08-05 14:16:06,514 - [__main__] Rank 1 - ERROR -   Index 1683: value=1392.000000
2025-08-05 14:16:06,514 - [__main__] Rank 1 - ERROR -   Index 1960: value=-480.000000
2025-08-05 14:16:06,514 - [__main__] Rank 1 - ERROR -   Index 49: value=-444.000000
2025-08-05 14:16:06,515 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1216.000, offset=24, step=256
2025-08-05 14:16:06,515 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=24 L15:off=24 L16:off=24 L17:off=24 L18:off=24 L19:off=24 L20:off=24 L21:off=24 L22:off=24 L23:off=24 L24:off=24 L25:off=24 L26:off=24 L27:off=24
2025-08-05 14:16:06,515 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=b73aeacbd888774e, norm=3888.000, first_4=[-18.875, 3.75, -38.5, 35.75], checksum=-720.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:06,519 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 83.500000, values=[-18.875, 3.75, -38.5, 35.75]...
2025-08-05 14:16:06,519 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=43a9feb3e17c9e66, data size=3319 bytes
2025-08-05 14:16:06,519 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:06,529 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:06,529 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:06,530 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: b73aeacbd888774e, size=3319
2025-08-05 14:16:06,919 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:06,919 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3335 bytes
2025-08-05 14:16:06,919 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3335
2025-08-05 14:16:06,919 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 9e1fb67e9b26abcb, size=3335
2025-08-05 14:16:06,919 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=9e1fb67e9b26abcb, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:06,924 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.750000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.750000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,929 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 7.750000, values=[1.7734375, 7.75, -1.21875, 0.36328125]...
2025-08-05 14:16:06,930 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=9e1fb67e9b26abcb, norm=152.000, first_4=[1.7734375, 7.75, -1.21875, 0.36328125], checksum=195.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:06,937 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,942 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,946 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,950 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,953 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,957 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,961 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,966 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,971 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,974 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,978 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,983 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,989 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,993 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:06,998 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,002 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,006 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,010 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,014 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,017 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,021 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,023 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,027 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,031 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,034 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,037 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,041 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,044 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=24 L15:off=24 L16:off=24 L17:off=24 L18:off=24 L19:off=24 L20:off=24 L21:off=24 L22:off=24 L23:off=24 L24:off=24 L25:off=24 L26:off=24 L27:off=24
2025-08-05 14:16:07,046 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:07,047 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.095215, var=11.250000, max_abs=39.250000 [CRITICAL][0m
2025-08-05 14:16:07,047 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=39.250000[0m
2025-08-05 14:16:07,047 - [__main__] Rank 1 - ERROR - First 10 values: [1.7734375, 7.75, -1.21875, 0.36328125, 0.328125, 1.484375, -0.30859375, 0.0234375, 2.484375, 3.125]
2025-08-05 14:16:07,048 - [__main__] Rank 1 - ERROR -   Index 1371: value=-39.250000
2025-08-05 14:16:07,048 - [__main__] Rank 1 - ERROR -   Index 1999: value=37.000000
2025-08-05 14:16:07,048 - [__main__] Rank 1 - ERROR -   Index 1793: value=-29.375000
2025-08-05 14:16:07,048 - [__main__] Rank 1 - ERROR -   Index 641: value=23.625000
2025-08-05 14:16:07,048 - [__main__] Rank 1 - ERROR -   Index 907: value=-19.750000
2025-08-05 14:16:07,050 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.157227, var=15.562500, max_abs=53.250000 [CRITICAL][0m
2025-08-05 14:16:07,050 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=53.250000[0m
2025-08-05 14:16:07,050 - [__main__] Rank 1 - ERROR - First 10 values: [1.734375, 12.5, -0.37890625, 2.53125, -2.1875, 0.18359375, 1.2421875, -2.609375, 3.0625, 3.46875]
2025-08-05 14:16:07,050 - [__main__] Rank 1 - ERROR -   Index 1999: value=53.250000
2025-08-05 14:16:07,051 - [__main__] Rank 1 - ERROR -   Index 1371: value=-51.250000
2025-08-05 14:16:07,051 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.750000
2025-08-05 14:16:07,051 - [__main__] Rank 1 - ERROR -   Index 940: value=24.250000
2025-08-05 14:16:07,051 - [__main__] Rank 1 - ERROR -   Index 641: value=22.000000
2025-08-05 14:16:07,052 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2288.000, offset=25, step=256
2025-08-05 14:16:07,052 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1040.000, offset=25, step=256
2025-08-05 14:16:07,053 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=656.000, offset=25, step=256
2025-08-05 14:16:07,054 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=4448.000, offset=25, step=256
2025-08-05 14:16:07,055 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=376.000, offset=25, step=256
2025-08-05 14:16:07,056 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2464.000, offset=25, step=256
2025-08-05 14:16:07,057 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2672.000, offset=25, step=256
2025-08-05 14:16:07,058 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=128.000, offset=25, step=256
2025-08-05 14:16:07,060 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-388.000, offset=25, step=256
2025-08-05 14:16:07,061 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1224.000, offset=25, step=256
2025-08-05 14:16:07,062 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2384.000, offset=25, step=256
2025-08-05 14:16:07,063 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2128.000, offset=25, step=256
2025-08-05 14:16:07,064 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3312.000, offset=25, step=256
2025-08-05 14:16:07,065 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=0.832031, var=6656.000000, max_abs=1888.000000 [CRITICAL][0m
2025-08-05 14:16:07,065 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1888.000000[0m
2025-08-05 14:16:07,065 - [__main__] Rank 1 - ERROR - First 10 values: [71.0, 76.0, -54.0, -12.875, -42.5, -43.0, -13.75, 3.5, 21.5, 11.0625]
2025-08-05 14:16:07,065 - [__main__] Rank 1 - ERROR -   Index 1793: value=1888.000000
2025-08-05 14:16:07,066 - [__main__] Rank 1 - ERROR -   Index 1683: value=1696.000000
2025-08-05 14:16:07,066 - [__main__] Rank 1 - ERROR -   Index 1999: value=1520.000000
2025-08-05 14:16:07,066 - [__main__] Rank 1 - ERROR -   Index 307: value=350.000000
2025-08-05 14:16:07,066 - [__main__] Rank 1 - ERROR -   Index 1436: value=254.000000
2025-08-05 14:16:07,068 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.096680, var=6848.000000, max_abs=1864.000000 [CRITICAL][0m
2025-08-05 14:16:07,068 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1864.000000[0m
2025-08-05 14:16:07,068 - [__main__] Rank 1 - ERROR - First 10 values: [88.5, 40.25, -31.5, 23.125, -54.75, -39.0, -2.0, 25.75, 7.875, 7.59375]
2025-08-05 14:16:07,068 - [__main__] Rank 1 - ERROR -   Index 1793: value=1864.000000
2025-08-05 14:16:07,068 - [__main__] Rank 1 - ERROR -   Index 1683: value=1440.000000
2025-08-05 14:16:07,068 - [__main__] Rank 1 - ERROR -   Index 1999: value=1408.000000
2025-08-05 14:16:07,069 - [__main__] Rank 1 - ERROR -   Index 425: value=-310.000000
2025-08-05 14:16:07,069 - [__main__] Rank 1 - ERROR -   Index 307: value=294.000000
2025-08-05 14:16:07,069 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1264.000, offset=25, step=256
2025-08-05 14:16:07,069 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=25 L15:off=25 L16:off=25 L17:off=25 L18:off=25 L19:off=25 L20:off=25 L21:off=25 L22:off=25 L23:off=25 L24:off=25 L25:off=25 L26:off=25 L27:off=25
2025-08-05 14:16:07,070 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=b2db0268e6a6af56, norm=3744.000, first_4=[88.5, 40.25, -31.5, 23.125], checksum=198.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:07,072 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 88.500000, values=[88.5, 40.25, -31.5, 23.125]...
2025-08-05 14:16:07,073 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=39486e0e6b762a0b, data size=3314 bytes
2025-08-05 14:16:07,073 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:07,086 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:07,087 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:07,088 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: b2db0268e6a6af56, size=3314
2025-08-05 14:16:07,471 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:07,471 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3316 bytes
2025-08-05 14:16:07,471 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3316
2025-08-05 14:16:07,471 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 7d59c59189bf2817, size=3316
2025-08-05 14:16:07,471 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=7d59c59189bf2817, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:07,476 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.531250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.531250, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,480 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 6.531250, values=[3.15625, 6.53125, -3.796875, -0.0771484375]...
2025-08-05 14:16:07,481 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=7d59c59189bf2817, norm=136.000, first_4=[3.15625, 6.53125, -3.796875, -0.0771484375], checksum=180.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:07,489 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,493 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,498 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,504 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,509 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,514 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,520 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,523 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,528 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,533 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,536 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,540 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,544 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,548 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,551 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,554 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,557 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,561 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,565 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,569 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,573 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,576 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,581 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,585 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,589 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,592 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,597 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,601 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:07,602 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:07,603 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:07,603 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:07,603 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:07,603 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=25 L15:off=25 L16:off=25 L17:off=25 L18:off=25 L19:off=25 L20:off=25 L21:off=25 L22:off=25 L23:off=25 L24:off=25 L25:off=25 L26:off=25 L27:off=25
2025-08-05 14:16:07,603 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:07,604 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.087891, var=9.000000, max_abs=37.750000 [CRITICAL][0m
2025-08-05 14:16:07,604 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=37.750000[0m
2025-08-05 14:16:07,604 - [__main__] Rank 1 - ERROR - First 10 values: [3.15625, 6.53125, -3.796875, -0.0771484375, 0.640625, 2.15625, -2.34375, 0.162109375, 3.078125, 0.1845703125]
2025-08-05 14:16:07,604 - [__main__] Rank 1 - ERROR -   Index 1371: value=-37.750000
2025-08-05 14:16:07,605 - [__main__] Rank 1 - ERROR -   Index 1999: value=37.250000
2025-08-05 14:16:07,605 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.250000
2025-08-05 14:16:07,605 - [__main__] Rank 1 - ERROR -   Index 641: value=20.750000
2025-08-05 14:16:07,606 - [__main__] Rank 1 - ERROR -   Index 307: value=17.750000
2025-08-05 14:16:07,607 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.141602, var=13.375000, max_abs=50.250000 [CRITICAL][0m
2025-08-05 14:16:07,607 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=50.250000[0m
2025-08-05 14:16:07,607 - [__main__] Rank 1 - ERROR - First 10 values: [3.234375, 10.3125, -3.53125, 2.9375, -1.109375, 1.4609375, 0.16015625, -1.1953125, 4.6875, 0.70703125]
2025-08-05 14:16:07,608 - [__main__] Rank 1 - ERROR -   Index 1371: value=-50.250000
2025-08-05 14:16:07,608 - [__main__] Rank 1 - ERROR -   Index 1999: value=49.000000
2025-08-05 14:16:07,608 - [__main__] Rank 1 - ERROR -   Index 1793: value=-36.000000
2025-08-05 14:16:07,608 - [__main__] Rank 1 - ERROR -   Index 940: value=22.625000
2025-08-05 14:16:07,608 - [__main__] Rank 1 - ERROR -   Index 641: value=19.875000
2025-08-05 14:16:07,609 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2448.000, offset=26, step=256
2025-08-05 14:16:07,609 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1112.000, offset=26, step=256
2025-08-05 14:16:07,610 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=720.000, offset=26, step=256
2025-08-05 14:16:07,611 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=4608.000, offset=26, step=256
2025-08-05 14:16:07,612 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=360.000, offset=26, step=256
2025-08-05 14:16:07,613 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2464.000, offset=26, step=256
2025-08-05 14:16:07,614 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2800.000, offset=26, step=256
2025-08-05 14:16:07,616 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=106.000, offset=26, step=256
2025-08-05 14:16:07,617 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-402.000, offset=26, step=256
2025-08-05 14:16:07,618 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1352.000, offset=26, step=256
2025-08-05 14:16:07,619 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2400.000, offset=26, step=256
2025-08-05 14:16:07,620 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2256.000, offset=26, step=256
2025-08-05 14:16:07,622 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3440.000, offset=26, step=256
2025-08-05 14:16:07,623 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=2.343750, var=7232.000000, max_abs=1960.000000 [CRITICAL][0m
2025-08-05 14:16:07,623 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1960.000000[0m
2025-08-05 14:16:07,623 - [__main__] Rank 1 - ERROR - First 10 values: [73.0, 46.25, -50.0, -35.5, 1.4375, -69.0, -15.9375, 14.8125, -12.8125, 16.75]
2025-08-05 14:16:07,624 - [__main__] Rank 1 - ERROR -   Index 1793: value=1960.000000
2025-08-05 14:16:07,624 - [__main__] Rank 1 - ERROR -   Index 1683: value=1776.000000
2025-08-05 14:16:07,624 - [__main__] Rank 1 - ERROR -   Index 1999: value=1672.000000
2025-08-05 14:16:07,625 - [__main__] Rank 1 - ERROR -   Index 1960: value=-386.000000
2025-08-05 14:16:07,625 - [__main__] Rank 1 - ERROR -   Index 307: value=346.000000
2025-08-05 14:16:07,627 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.503906, var=4800.000000, max_abs=1296.000000 [CRITICAL][0m
2025-08-05 14:16:07,627 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1296.000000[0m
2025-08-05 14:16:07,627 - [__main__] Rank 1 - ERROR - First 10 values: [75.0, 8.25, -26.625, -16.75, -8.5, -65.0, -3.15625, 51.5, -43.25, 35.0]
2025-08-05 14:16:07,628 - [__main__] Rank 1 - ERROR -   Index 1793: value=1296.000000
2025-08-05 14:16:07,628 - [__main__] Rank 1 - ERROR -   Index 1683: value=952.000000
2025-08-05 14:16:07,628 - [__main__] Rank 1 - ERROR -   Index 1999: value=912.000000
2025-08-05 14:16:07,628 - [__main__] Rank 1 - ERROR -   Index 1960: value=-412.000000
2025-08-05 14:16:07,629 - [__main__] Rank 1 - ERROR -   Index 47: value=342.000000
2025-08-05 14:16:07,629 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1304.000, offset=26, step=256
2025-08-05 14:16:07,629 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=26 L15:off=26 L16:off=26 L17:off=26 L18:off=26 L19:off=26 L20:off=26 L21:off=26 L22:off=26 L23:off=26 L24:off=26 L25:off=26 L26:off=26 L27:off=26
2025-08-05 14:16:07,629 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=6c777ceeafbd037f, norm=3136.000, first_4=[75.0, 8.25, -26.625, -16.75], checksum=1032.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:07,633 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 99.500000, values=[75.0, 8.25, -26.625, -16.75]...
2025-08-05 14:16:07,633 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=228f9789cb87f620, data size=3313 bytes
2025-08-05 14:16:07,633 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:07,647 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:07,647 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:07,649 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: 6c777ceeafbd037f, size=3313
2025-08-05 14:16:08,057 - [__main__] Rank 1 - INFO - Worker 1 processing layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:08,057 - [__main__] Rank 1 - INFO - Worker received input_tensor size: 3331 bytes
2025-08-05 14:16:08,058 - [__main__] Rank 1 - INFO - WORKER RECV metadata: dtype=bfloat16_as_uint16, original_dtype=bfloat16, shape=[1, 1, 2048], data_size=3331
2025-08-05 14:16:08,058 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR WIRE: SHA-256 of received bytes: 55655fe83ec49858, size=3331
2025-08-05 14:16:08,058 - [__main__] Rank 1 - INFO - WORKER<-COORDINATOR: wire sha256=55655fe83ec49858, metadata checksum=NO_CHECKSUM
2025-08-05 14:16:08,062 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 8.062500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 210, in ProcessLayers
    hidden_states = deserialize_mlx_array(request.input_tensor, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 312, in deserialize_mlx_array
    return deserialize_tensor(data, metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 8.062500, shape=(1, 1, 2048), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,067 - [__main__] Rank 1 - INFO - WORKER RECV MAX-ABS (first 16): 8.062500, values=[2.5, 8.0625, -5.0625, 0.9609375]...
2025-08-05 14:16:08,068 - [__main__] Rank 1 - INFO - WORKER RECV: bytes_sha256=55655fe83ec49858, norm=139.000, first_4=[2.5, 8.0625, -5.0625, 0.9609375], checksum=182.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16
2025-08-05 14:16:08,076 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.562500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,081 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.174805, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,085 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.250000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,091 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.269531, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,096 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 11.500000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,100 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.431641, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,104 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 5.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,107 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.625000, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,111 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,114 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.476562, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,118 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.593750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,121 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,125 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 7.093750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,131 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 0.964844, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,134 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.937500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,137 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.898438, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,140 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.062500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,143 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,146 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 6.781250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,149 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.742188, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,153 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.281250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,156 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.531250, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,159 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 2.234375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,163 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 3.078125, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,167 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 1.609375, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,170 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.187500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,173 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 466, in deserialize_kv_cache
    keys = deserialize_tensor(keys_data, entry_meta['keys_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.312500, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,177 - [src.utils.tensor_utils] - INFO - Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16
--- Logging error ---
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 472, in format
    return self._format(record)
           ~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 468, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'rank'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 1151, in emit
    msg = self.format(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 715, in format
    s = self.formatMessage(record)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 684, in formatMessage
    return self._style.format(record)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py", line 474, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'rank'
Call stack:
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 93, in _worker
    work_item.run()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/mini1/Movies/mlx_grpc_inference/server_distributed.py", line 278, in ProcessLayers
    compact_cache = deserialize_kv_cache(request.kv_cache_data, cache_metadata)
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 467, in deserialize_kv_cache
    values = deserialize_tensor(values_data, entry_meta['values_meta'])
  File "/Users/mini1/Movies/mlx_grpc_inference/src/utils/tensor_utils.py", line 232, in deserialize_tensor
    logger.info(f"Deserialized tensor max-abs (first 16): {max_abs:.6f}, shape={mx_array.shape}, dtype={mx_array.dtype}")
Message: 'Deserialized tensor max-abs (first 16): 4.343750, shape=(1, 8, 256, 128), dtype=mlx.core.bfloat16'
Arguments: ()
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - Received compact KV cache with 14 entries for layers [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - RANK1 cache before: (0,8) (1,8) (2,8) (3,8) (4,8) (5,8) (6,8) (7,8) (8,8) (9,8)
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - RANK1 cache before (cont): (10,8) (11,8) (12,8) (13,8) (14,8) (15,8) (16,8) (17,8) (18,8) (19,8)
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - RANK1 cache before (end): (20,8) (21,8) (22,8) (23,8) (24,8) (25,8) (26,8) (27,8)
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - WORKER1 cache offsets BEFORE: L14:off=26 L15:off=26 L16:off=26 L17:off=26 L18:off=26 L19:off=26 L20:off=26 L21:off=26 L22:off=26 L23:off=26 L24:off=26 L25:off=26 L26:off=26 L27:off=26
2025-08-05 14:16:08,177 - [__main__] Rank 1 - INFO - WORKER processing with mask CRC: NO_MASK
2025-08-05 14:16:08,178 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 14: mean=0.088867, var=9.312500, max_abs=39.500000 [CRITICAL][0m
2025-08-05 14:16:08,178 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 BEFORE! max_abs=39.500000[0m
2025-08-05 14:16:08,178 - [__main__] Rank 1 - ERROR - First 10 values: [2.5, 8.0625, -5.0625, 0.9609375, 0.8046875, 1.4375, -1.7265625, 0.154296875, 1.203125, -4.34375]
2025-08-05 14:16:08,179 - [__main__] Rank 1 - ERROR -   Index 1999: value=39.500000
2025-08-05 14:16:08,180 - [__main__] Rank 1 - ERROR -   Index 1371: value=-37.000000
2025-08-05 14:16:08,180 - [__main__] Rank 1 - ERROR -   Index 1793: value=-31.625000
2025-08-05 14:16:08,180 - [__main__] Rank 1 - ERROR -   Index 319: value=-18.750000
2025-08-05 14:16:08,181 - [__main__] Rank 1 - ERROR -   Index 641: value=18.500000
2025-08-05 14:16:08,182 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 14: mean=0.135742, var=13.250000, max_abs=51.750000 [CRITICAL][0m
2025-08-05 14:16:08,183 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 14 AFTER! max_abs=51.750000[0m
2025-08-05 14:16:08,183 - [__main__] Rank 1 - ERROR - First 10 values: [2.3125, 12.625, -4.375, 3.0, -1.3125, 0.3046875, 0.28125, -0.49609375, 2.25, -4.375]
2025-08-05 14:16:08,183 - [__main__] Rank 1 - ERROR -   Index 1999: value=51.750000
2025-08-05 14:16:08,183 - [__main__] Rank 1 - ERROR -   Index 1371: value=-49.250000
2025-08-05 14:16:08,184 - [__main__] Rank 1 - ERROR -   Index 1793: value=-34.250000
2025-08-05 14:16:08,184 - [__main__] Rank 1 - ERROR -   Index 940: value=22.250000
2025-08-05 14:16:08,184 - [__main__] Rank 1 - ERROR -   Index 58: value=20.250000
2025-08-05 14:16:08,184 - [__main__] Rank 1 - INFO - WORKER1 layer 14: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2592.000, offset=27, step=256
2025-08-05 14:16:08,185 - [__main__] Rank 1 - INFO - WORKER1 layer 15: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-1184.000, offset=27, step=256
2025-08-05 14:16:08,186 - [__main__] Rank 1 - INFO - WORKER1 layer 16: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=776.000, offset=27, step=256
2025-08-05 14:16:08,187 - [__main__] Rank 1 - INFO - WORKER1 layer 17: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=4704.000, offset=27, step=256
2025-08-05 14:16:08,188 - [__main__] Rank 1 - INFO - WORKER1 layer 18: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=360.000, offset=27, step=256
2025-08-05 14:16:08,190 - [__main__] Rank 1 - INFO - WORKER1 layer 19: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2512.000, offset=27, step=256
2025-08-05 14:16:08,191 - [__main__] Rank 1 - INFO - WORKER1 layer 20: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=2944.000, offset=27, step=256
2025-08-05 14:16:08,192 - [__main__] Rank 1 - INFO - WORKER1 layer 21: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=150.000, offset=27, step=256
2025-08-05 14:16:08,193 - [__main__] Rank 1 - INFO - WORKER1 layer 22: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-424.000, offset=27, step=256
2025-08-05 14:16:08,195 - [__main__] Rank 1 - INFO - WORKER1 layer 23: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1432.000, offset=27, step=256
2025-08-05 14:16:08,196 - [__main__] Rank 1 - INFO - WORKER1 layer 24: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2464.000, offset=27, step=256
2025-08-05 14:16:08,197 - [__main__] Rank 1 - INFO - WORKER1 layer 25: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=-2320.000, offset=27, step=256
2025-08-05 14:16:08,198 - [__main__] Rank 1 - INFO - WORKER1 layer 26: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=3552.000, offset=27, step=256
2025-08-05 14:16:08,199 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats BEFORE layer 27: mean=1.656250, var=7232.000000, max_abs=1944.000000 [CRITICAL][0m
2025-08-05 14:16:08,199 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 BEFORE! max_abs=1944.000000[0m
2025-08-05 14:16:08,199 - [__main__] Rank 1 - ERROR - First 10 values: [60.5, 36.5, -36.25, -27.25, -5.8125, -66.0, -3.25, -9.125, -20.125, 8.5]
2025-08-05 14:16:08,200 - [__main__] Rank 1 - ERROR -   Index 1793: value=1944.000000
2025-08-05 14:16:08,200 - [__main__] Rank 1 - ERROR -   Index 1683: value=1808.000000
2025-08-05 14:16:08,200 - [__main__] Rank 1 - ERROR -   Index 1999: value=1672.000000
2025-08-05 14:16:08,200 - [__main__] Rank 1 - ERROR -   Index 1960: value=-376.000000
2025-08-05 14:16:08,201 - [__main__] Rank 1 - ERROR -   Index 307: value=358.000000
2025-08-05 14:16:08,202 - [__main__] Rank 1 - INFO - [91m[1mLayerNorm stats AFTER layer 27: mean=0.171875, var=4960.000000, max_abs=1296.000000 [CRITICAL][0m
2025-08-05 14:16:08,202 - [__main__] Rank 1 - ERROR - [91mDIVERGENCE DETECTED at layer 27 AFTER! max_abs=1296.000000[0m
2025-08-05 14:16:08,202 - [__main__] Rank 1 - ERROR - First 10 values: [62.5, -2.0, -6.625, 8.375, -27.5, -70.0, 0.375, 20.0, -47.25, 13.4375]
2025-08-05 14:16:08,203 - [__main__] Rank 1 - ERROR -   Index 1793: value=1296.000000
2025-08-05 14:16:08,203 - [__main__] Rank 1 - ERROR -   Index 1683: value=1020.000000
2025-08-05 14:16:08,203 - [__main__] Rank 1 - ERROR -   Index 1999: value=948.000000
2025-08-05 14:16:08,204 - [__main__] Rank 1 - ERROR -   Index 1960: value=-404.000000
2025-08-05 14:16:08,204 - [__main__] Rank 1 - ERROR -   Index 47: value=350.000000
2025-08-05 14:16:08,204 - [__main__] Rank 1 - INFO - WORKER1 layer 27: cache_is_none=False, seq_len=8, keys_shape=(1, 8, 256, 128), keys_sum=1344.000, offset=27, step=256
2025-08-05 14:16:08,204 - [__main__] Rank 1 - INFO - WORKER1 cache offsets AFTER: L14:off=27 L15:off=27 L16:off=27 L17:off=27 L18:off=27 L19:off=27 L20:off=27 L21:off=27 L22:off=27 L23:off=27 L24:off=27 L25:off=27 L26:off=27 L27:off=27
2025-08-05 14:16:08,206 - [__main__] Rank 1 - INFO - WORKER SEND: bytes_sha256=a501e5c70e44aa59, norm=3184.000, first_4=[62.5, -2.0, -6.625, 8.375], checksum=352.000000, shape=(1, 1, 2048), dtype=mlx.core.bfloat16, transmitted_dtype=bfloat16_as_uint16
2025-08-05 14:16:08,209 - [__main__] Rank 1 - INFO - WORKER SEND MAX-ABS (first 16): 100.000000, values=[62.5, -2.0, -6.625, 8.375]...
2025-08-05 14:16:08,209 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR: metadata checksum=7a6857ef03d46309, data size=3322 bytes
2025-08-05 14:16:08,209 - [__main__] Rank 1 - INFO - Worker 1 sending 14 cache entries (indices: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]) instead of full 28
2025-08-05 14:16:08,221 - [__main__] Rank 1 - INFO - Worker 1 cache payload size: 14.00MB
2025-08-05 14:16:08,221 - [__main__] Rank 1 - INFO - Worker 1 total response size: 14.00MB (tensor: 0.00MB, cache: 14.00MB)
2025-08-05 14:16:08,223 - [__main__] Rank 1 - INFO - WORKER->COORDINATOR WIRE: SHA-256 of transmitted bytes: a501e5c70e44aa59, size=3322
